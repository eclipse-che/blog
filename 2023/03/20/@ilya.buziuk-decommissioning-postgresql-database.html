<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Begin Jekyll SEO tag v2.8.0 -->
    <title>Decommissioning the PostgreSQL database | Eclipse Che Blog</title>
    <meta name="generator" content="Jekyll v4.2.2" />
    <meta
      property="og:title"
      content="Decommissioning the PostgreSQL database"
    />
    <meta name="author" content="Ilya Buziuk" />
    <meta property="og:locale" content="en_US" />
    <meta
      name="description"
      content="The article describes how the PostgreSQL database dependency has been removed in Eclipse Che"
    />
    <meta
      property="og:description"
      content="The article describes how the PostgreSQL database dependency has been removed in Eclipse Che"
    />
    <link
      rel="canonical"
      href="https://che.eclipseprojects.io/2023/03/20/@ilya.buziuk-decommissioning-postgresql-database.html"
    />
    <meta
      property="og:url"
      content="https://che.eclipseprojects.io/2023/03/20/@ilya.buziuk-decommissioning-postgresql-database.html"
    />
    <meta property="og:site_name" content="Eclipse Che Blog" />
    <meta property="og:type" content="article" />
    <meta
      property="article:published_time"
      content="2023-03-20T00:00:00+00:00"
    />
    <meta name="twitter:card" content="summary" />
    <meta
      property="twitter:title"
      content="Decommissioning the PostgreSQL database"
    />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": { "@type": "Person", "name": "Ilya Buziuk" },
        "dateModified": "2023-03-20T00:00:00+00:00",
        "datePublished": "2023-03-20T00:00:00+00:00",
        "description": "The article describes how the PostgreSQL database dependency has been removed in Eclipse Che",
        "headline": "Decommissioning the PostgreSQL database",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://che.eclipseprojects.io/2023/03/20/@ilya.buziuk-decommissioning-postgresql-database.html"
        },
        "url": "https://che.eclipseprojects.io/2023/03/20/@ilya.buziuk-decommissioning-postgresql-database.html"
      }
    </script>
    <!-- End Jekyll SEO tag -->
    <link rel="stylesheet" href="/assets/main.css" />
    <link
      type="application/atom+xml"
      rel="alternate"
      href="https://che.eclipseprojects.io/feed.xml"
      title="Eclipse Che Blog"
    />
    <script>
      if (
        !(
          window.doNotTrack === "1" ||
          navigator.doNotTrack === "1" ||
          navigator.doNotTrack === "yes" ||
          navigator.msDoNotTrack === "1"
        )
      ) {
        (function (i, s, o, g, r, a, m) {
          i["GoogleAnalyticsObject"] = r;
          (i[r] =
            i[r] ||
            function () {
              (i[r].q = i[r].q || []).push(arguments);
            }),
            (i[r].l = 1 * new Date());
          (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
          a.async = 1;
          a.src = g;
          m.parentNode.insertBefore(a, m);
        })(
          window,
          document,
          "script",
          "https://www.google-analytics.com/analytics.js",
          "ga"
        );

        ga("create", "UA-215676970-1", "auto");
        ga("send", "pageview");
      }
    </script>
  </head>
  <body>
    <header class="site-header" role="banner">
      <div class="wrapper">
        <a class="site-title" rel="author" href="/">Eclipse Che Blog</a>
        <nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path
                  d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"
                />
              </svg>
            </span>
          </label>

          <div class="trigger"></div>
        </nav>
      </div>
    </header>
    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article
          class="post h-entry"
          itemscope
          itemtype="http://schema.org/BlogPosting"
        >
          <header class="post-header">
            <h1 class="post-title p-name" itemprop="name headline">
              Decommissioning the PostgreSQL database
            </h1>
            <p class="post-meta">
              <time
                class="dt-published"
                datetime="2023-03-20T00:00:00+00:00"
                itemprop="datePublished"
                >Mar 20, 2023 </time
              >â€¢
              <span
                itemprop="author"
                itemscope
                itemtype="http://schema.org/Person"
                ><span class="p-author h-card" itemprop="name"
                  >Ilya Buziuk</span
                ></span
              >
            </p>
          </header>

          <div class="post-content e-content" itemprop="articleBody">
            <div class="paragraph">
              <p>
                Historically Eclipse&#160;Che used a PostgreSQL database for
                storing relevant information about the users, workspaces,
                devfiles, preferences, SSH keys, etc. Overall there were dozens
                of tables in the database which represent the state of the
                Eclipse&#160;Che instance:
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre
                  class="rouge highlight"
                  style="color: #f8f8f2; background-color: #49483e"
                ><code data-lang="bash">psql <span style="color: #f92672;font-weight: bold">(</span>13.7<span style="color: #f92672;font-weight: bold">)</span>
Type <span style="color: #e6db74">"help"</span> <span style="color: #66d9ef;font-weight: bold">for </span>help.

<span style="color: #f8f8f2">dbche</span><span style="color: #f92672;font-weight: bold">=&gt;</span> <span style="color: #ae81ff">\d</span>t
                            List of relations
 Schema |                      Name                       | Type  | Owner
<span style="color: #f92672">--------</span>+-------------------------------------------------+-------+-------
 public | account                                         | table | pgche
 public | che_factory                                     | table | pgche
 public | che_factory_action                              | table | pgche
 public | che_factory_action_properties                   | table | pgche
 public | che_factory_ide                                 | table | pgche
 public | che_factory_on_app_closed_action                | table | pgche
 public | che_factory_on_app_closed_action_value          | table | pgche
 public | che_factory_on_app_loaded_action                | table | pgche
 public | che_factory_on_app_loaded_action_value          | table | pgche
 public | che_factory_on_projects_loaded_action           | table | pgche
 public | che_factory_on_projects_loaded_action_value     | table | pgche
 public | che_free_resources_limit                        | table | pgche
 public | che_free_resources_limit_resource               | table | pgche
 public | che_k8s_machine                                 | table | pgche
 public | che_k8s_machine_attributes                      | table | pgche
 public | che_k8s_runtime                                 | table | pgche
 public | che_k8s_server                                  | table | pgche
 public | che_k8s_server_attributes                       | table | pgche
 public | che_member                                      | table | pgche
 public | che_member_actions                              | table | pgche
 public | che_organization                                | table | pgche
 public | che_organization_distributed_resources          | table | pgche
 public | che_organization_distributed_resources_resource | table | pgche
 public | che_resource                                    | table | pgche
 public | che_sign_key                                    | table | pgche
 public | che_sign_key_pair                               | table | pgche
 public | che_system_permissions                          | table | pgche
 public | che_system_permissions_actions                  | table | pgche
 public | che_userdevfile_permissions                     | table | pgche
 public | che_userdevfile_permissions_actions             | table | pgche
 public | che_worker                                      | table | pgche
 public | che_worker_actions                              | table | pgche
 public | che_workspace_activity                          | table | pgche
 public | che_workspace_cfg_attributes                    | table | pgche
 public | <span style="color: #f8f8f2">command</span>                                         | table | pgche
 public | command_attributes                              | table | pgche
 public | devfile                                         | table | pgche
 public | devfile_action                                  | table | pgche
 public | devfile_attributes                              | table | pgche
 public | devfile_command                                 | table | pgche
 public | devfile_command_attributes                      | table | pgche
 public | devfile_component                               | table | pgche
 public | devfile_component_arg                           | table | pgche
 public | devfile_component_command                       | table | pgche
 public | devfile_component_preferences                   | table | pgche
 public | devfile_component_selector                      | table | pgche
 public | devfile_endpoint                                | table | pgche
 public | devfile_endpoint_attributes                     | table | pgche
 public | devfile_entrypoint                              | table | pgche
 public | devfile_entrypoint_arg                          | table | pgche
 public | devfile_entrypoint_commands                     | table | pgche
 public | devfile_entrypoint_selector                     | table | pgche
 public | devfile_env                                     | table | pgche
 public | devfile_project                                 | table | pgche
 public | devfile_volume                                  | table | pgche
 public | environment                                     | table | pgche
 public | externalmachine                                 | table | pgche
 public | externalmachine_attributes                      | table | pgche
 public | externalmachine_env                             | table | pgche
 public | k8s_runtime_command                             | table | pgche
 public | k8s_runtime_command_attributes                  | table | pgche
 public | machine_volume                                  | table | pgche
 public | preference                                      | table | pgche
 public | preference_preferences                          | table | pgche
 public | profile                                         | table | pgche
 public | profile_attributes                              | table | pgche
 public | projectattribute                                | table | pgche
 public | projectattribute_values                         | table | pgche
 public | projectconfig                                   | table | pgche
 public | projectconfig_mixins                            | table | pgche
 public | schema_version                                  | table | pgche
 public | sequence                                        | table | pgche
 public | serverconf                                      | table | pgche
 public | serverconf_attributes                           | table | pgche
 public | serverconf_properties                           | table | pgche
 public | sourcestorage                                   | table | pgche
 public | sourcestorage_parameters                        | table | pgche
 public | sshkeypair                                      | table | pgche
 public | user_aliases                                    | table | pgche
 public | userdevfile                                     | table | pgche
 public | usr                                             | table | pgche
 public | workspace                                       | table | pgche
 public | workspace_attributes                            | table | pgche
 public | workspaceconfig                                 | table | pgche
<span style="color: #f92672;font-weight: bold">(</span>84 rows<span style="color: #f92672;font-weight: bold">)</span></code></pre>
              </div>
            </div>
            <div class="paragraph">
              <p>
                However, with the switch to
                <a
                  href="https://che.eclipseprojects.io/2021/10/12/@mario.loriedo-devfile-v2-and-the-devworkspace-operator-p1.html"
                  >DevWorkspace Operator and Devfile v2</a
                >, all this data becomes irrelevant since we started using
                native Kubernetes resources instead.
              </p>
            </div>
            <div class="paragraph">
              <p>
                The data is now stored and managed as Kubernetes resources such
                as Secrets and ConfigMaps in the user namespaces:
              </p>
            </div>
            <div class="imageblock">
              <div class="content">
                <img
                  src="/assets/img/decommissioning-postgresql-database/secrets.png"
                  alt="Secrets from the user namespace"
                />
              </div>
            </div>
            <div class="imageblock">
              <div class="content">
                <img
                  src="/assets/img/decommissioning-postgresql-database/configmaps.png"
                  alt="ConfigMaps from the user namespace"
                />
              </div>
            </div>
            <div class="paragraph">
              <p>&#160;<br /></p>
            </div>
            <div class="paragraph">
              <p>
                As an example, SSH keys are now configured using the dedicated
                <a
                  href="https://github.com/devfile/devworkspace-operator/blob/main/docs/additional-configuration.adoc#configuring-devworkspaces-to-use-ssh-keys-for-git-operations"
                  >secret</a
                >.
              </p>
            </div>
            <div class="paragraph">
              <p>
                Starting from the Eclipse&#160;Che <code>7.62.0</code> release,
                the PostgreSQL deployment has ceased to exist, resulting in only
                5 operands: Che Server, User Dashboard, Plugin Registry, Devfile
                Registry, and Gateway.
              </p>
            </div>
            <div class="imageblock">
              <div class="content">
                <img
                  src="/assets/img/decommissioning-postgresql-database/operands.png"
                  alt="Eclipse Che operands"
                />
              </div>
            </div>
            <div class="paragraph">
              <p>&#160;<br /></p>
            </div>
            <div class="admonitionblock important">
              <table>
                <tr>
                  <td class="icon">
                    <div class="title">Important</div>
                  </td>
                  <td class="content">
                    No manual migration steps or action items are required for
                    this change to take effect. The PostgreSQL deployment will
                    be gracefully terminated and removed during the update. All
                    the obsolete data stored in the database will be removed.
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>
                It is also worth mentioning that most of the
                <code
                  ><a href="https://&lt;che_fqdn&gt;/swagger" class="bare"
                    >https://&lt;che_fqdn&gt;/swagger</a
                  ></code
                >
                endpoints are now deprecated and going to be removed in future
                releases. The only endpoints that are still used are related to
                the namespace provisioning, Git OAuth configuration, and the
                factory flow:
              </p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p><code>/kubernetes/namespace/*</code></p>
                </li>
                <li>
                  <p><code>/oauth/*</code></p>
                </li>
                <li>
                  <p><code>/factory/*</code></p>
                </li>
              </ul>
            </div>
            <div class="sect1">
              <h2 id="_next-steps">Next steps</h2>
              <div class="sectionbody">
                <div class="paragraph">
                  <p>
                    Decommissioning the PostgreSQL database in favor of native
                    Kubernetes resources provides several benefits, including:
                    improved scalability, flexibility, and easier management.
                  </p>
                </div>
                <div class="paragraph">
                  <p>
                    Ultimately, moving away from traditional database
                    architectures and embracing Kubernetes makes
                    Eclipse&#160;Che agile and competitive in an increasingly
                    complex and demanding technology landscape. For example, in
                    the next Eclipse&#160;Che releases we plan to make it
                    possible to configure a number of replicas for operands from
                    the CheCluster CustomResource, which was not possible before
                    due to the PostgreSQL database dependency:
                  </p>
                </div>
                <div class="listingblock">
                  <div class="content">
                    <pre
                      class="rouge highlight"
                      style="color: #f8f8f2; background-color: #49483e"
                    ><code data-lang="yaml"><span style="color: #a6e22e">spec</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
  <span style="color: #a6e22e">components</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">cheServer</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
      <span style="color: #a6e22e">deployment</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
        <span style="color: #a6e22e">replicas</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span>
    <span style="color: #a6e22e">dashboard</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
      <span style="color: #a6e22e">deployment</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
        <span style="color: #a6e22e">replicas</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span>
    <span style="color: #a6e22e">devfileRegistry</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
      <span style="color: #a6e22e">deployment</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
        <span style="color: #a6e22e">replicas</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span>
    <span style="color: #a6e22e">pluginRegistry</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
      <span style="color: #a6e22e">deployment</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
        <span style="color: #a6e22e">replicas</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">1</span></code></pre>
                  </div>
                </div>
                <div class="paragraph">
                  <p>
                    The progress of this particular feature can be tracked in
                    the upstream
                    <a href="https://github.com/eclipse/che/issues/22067"
                      >issue</a
                    >. As always, we look forward to your valuable feedback,
                    comments, remarks, and proposals on this work or anything
                    else related to the project, through our
                    <a href="https://accounts.eclipse.org/mailing-list/che-dev"
                      >mailing list</a
                    >,
                    <a href="https://github.com/eclipse/che/issues">GitHub</a>,
                    or
                    <a
                      href="https://mattermost.eclipse.org/eclipse/channels/eclipse-che"
                      >Mattermost</a
                    >. &#160;<br />
                    We wish you an enjoyable and productive coding experience
                    with Eclipse&#160;Che!
                  </p>
                </div>
              </div>
            </div>
          </div>
          <a
            class="u-url"
            href="/2023/03/20/@ilya.buziuk-decommissioning-postgresql-database.html"
            hidden
          ></a>
        </article>
      </div>
    </main>
    <footer class="site-footer h-card">
      <data class="u-url" href="/"></data>

      <div class="wrapper">
        <h2 class="footer-heading">Eclipse Che Blog</h2>

        <div class="footer-col-wrapper">
          <div class="footer-col footer-col-1">
            <ul class="contact-list">
              <li class="p-name">Eclipse Che Blog</li>
              <li>
                <a class="u-email" href="mailto:che-dev@eclipse.org"
                  >che-dev@eclipse.org</a
                >
              </li>
            </ul>
          </div>

          <div class="footer-col footer-col-2">
            <ul class="social-media-list">
              <li>
                <a href="https://github.com/eclipse-che"
                  ><svg class="svg-icon">
                    <use
                      xlink:href="/assets/minima-social-icons.svg#github"
                    ></use>
                  </svg>
                  <span class="username">eclipse-che</span></a
                >
              </li>
              <li>
                <a href="https://www.twitter.com/eclipse_che"
                  ><svg class="svg-icon">
                    <use
                      xlink:href="/assets/minima-social-icons.svg#twitter"
                    ></use>
                  </svg>
                  <span class="username">eclipse_che</span></a
                >
              </li>
            </ul>
          </div>

          <div class="footer-col footer-col-3">
            <p>Eclipse Che runs IDEs in Kubernetes.</p>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>
