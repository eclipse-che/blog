<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.1">Jekyll</generator><link href="https://che.eclipseprojects.io/feed.xml" rel="self" type="application/atom+xml" /><link href="https://che.eclipseprojects.io/" rel="alternate" type="text/html" /><updated>2022-01-25T15:33:37+00:00</updated><id>https://che.eclipseprojects.io/feed.xml</id><title type="html">Eclipse Che Blog</title><subtitle>Eclipse Che runs IDEs in Kubernetes.</subtitle><entry><title type="html">Contributing for the first time to a project</title><link href="https://che.eclipseprojects.io/2022/01/11/@ilya.buziuk-contributing-for-the-first-time-to-a-project.html" rel="alternate" type="text/html" title="Contributing for the first time to a project" /><published>2022-01-11T00:00:00+00:00</published><updated>2022-01-11T00:00:00+00:00</updated><id>https://che.eclipseprojects.io/2022/01/11/@ilya.buziuk/contributing-for-the-first-time-to-a-project</id><content type="html" xml:base="https://che.eclipseprojects.io/2022/01/11/@ilya.buziuk-contributing-for-the-first-time-to-a-project.html"><![CDATA[<div class="sect2">
<h3 id="introduction">Introduction</h3>
<div class="paragraph">
<p>The complexity of applications has changed dramatically over the last decade, and nowadays it is not always straightforward to contribute to a new project for the first time.
At the beginning, developers need to properly set up the local environment including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>build tools</p>
</li>
<li>
<p>runtimes</p>
</li>
<li>
<p>dependencies</p>
</li>
<li>
<p>IDEs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For complex projects, it could easily take weeks for new developers to get the builds running on their machines.
In general, a significant amount of the team&#8217;s week is spent on building and maintaining developer environments.
With Eclipse&#160;Che we are solving the complexity of the onboarding, configuration, and setup by defining a new cloud-native, zero-install, and repeatable concept of a workspace.</p>
</div>
</div>
<div class="sect2">
<h3 id="contributing-for-the-first-time-to-a-project-using-eclipseche">Contributing for the first time to a project using Eclipse&#160;Che</h3>
<div class="paragraph">
<p>The motto of Eclipse&#160;Che is that anyone anytime can contribute to a project without installing software.
In order to contribute to a project, just click on the badge defined in the <code>README.md</code> file of the repository, and within a minute you will get a workspace ready for development with all the tools and runtimes available out of the box.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/img/contribute-to-a-project/contribute.png" alt="Contribute Badge">
</div>
<div class="title">Figure 1. The Eclipse&#160;Che contribute badge in <code>README.md</code></div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>By default, Eclipse&#160;Che is using a customized version of <a href="https://theia-ide.org/">Theia</a>, which provides <a href="https://code.visualstudio.com/">VS Code</a>-like experience including the support of extensions:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/img/contribute-to-a-project/ide.png" alt="Eclipse&#160;Che Theia IDE">
</div>
<div class="title">Figure 2. Eclipse&#160;Che Theia IDE</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>Programming languages facilities like code completion, navigation, and CodeLens are provided using the <a href="https://microsoft.github.io/language-server-protocol/">Language Server Protocol</a>. Eclipse&#160;Che benefits from a growing ecosystem of over 60 available language servers, delivering intelligent editing support for all major programming languages.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/img/contribute-to-a-project/content-assist.png" alt="Content Assist">
</div>
<div class="title">Figure 3. Java Content Assist</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>Pre-defined commands (<code>Terminal</code> &#8594; <code>Run Task&#8230;&#8203;</code>) allow you to easily build, run, debug, and test the application.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/img/contribute-to-a-project/commands.png" alt="IDE Commands">
</div>
<div class="title">Figure 4. Pre-defined commands</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>Additional extensions can be enabled by using the <code>Ctrl+Shift+J</code> shortcut or <code>View</code> &#8594; <code>Plugins</code> menu items:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/img/contribute-to-a-project/plugins.png" alt="The 'Plugins' view">
</div>
<div class="title">Figure 5. The 'Plugins' view</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>Debug the application by using the <code>F5</code> shortcut or <code>Run</code> &#8594; <code>Start Debugging</code> menu items:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/img/contribute-to-a-project/debug.png" alt="Debugging the application">
</div>
<div class="title">Figure 6. Debugging Java application</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>Commit and push the changes from the terminal or use the <code>Source Control</code> view:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/img/contribute-to-a-project/source-control.png" alt="[The 'Source Control' view">
</div>
<div class="title">Figure 7. The 'Source Control' view</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>Now you are ready for the first contribution. For GitHub, a dedicated plugin is available that allows opening pull requests right from the IDE:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/img/contribute-to-a-project/github-plugin.png" alt="[The 'GitHub' plugin">
</div>
<div class="title">Figure 8. The 'GitHub' plugin</div>
</div>
<div class="paragraph">
<p></p>
</div>
</div>
<div class="sect2">
<h3 id="how-can-maintainers-set-up-their-projects-to-use-eclipseche">How can maintainers set up their projects to use Eclipse&#160;Che?</h3>
<div class="ulist">
<ul>
<li>
<p>Deploy Eclipse&#160;Che on a Kubernetes cluster or use <a href="https://workspaces.openshift.com/">Eclipse Che hosted by Red Hat</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
At the moment, <a href="https://workspaces.openshift.com/">Eclipse Che hosted by Red Hat</a> does not use the DevWorkspace Operator that is in charge of the devfile v2 support.
The switch to the DevWorkspace engine is planned for spring 2022.
Currently, devfiles v2 are automatically converted to devfile v1 equivalents via the <a href="https://github.com/che-incubator/devfile-converter">converter library</a> under the hood during workspace startup.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">The recommended file structure of the repository</div>
<div class="content">
<pre>  |--- devfile.yaml
  |--- README.md
  |___ .che
         |___ che-editor.yaml
         |___ che-theia-plugins.yaml
  |___ .vscode
         |___ extensions.json
         |___ launch.json</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add <code>.devfile.yaml</code> or <code>devfile.yaml</code> file to the root of the project in order to specify the relevant components and commands in a declarative way.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The devfile provides easy to configure, highly reproducible definitions of portable developer environments.
For more information about devfiles, see the <a href="https://devfile.io/">Devfile Documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Omitting the creation of the devfile file will result in using a default container based on the <a href="https://quay.io/repository/devfile/universal-developer-image">Universal Developer Image</a>,
which provides various languages (including Java, Node.js, Python, PHP, Golang, etc) and tools (including <code>curl</code>, <code>jq</code>, <code>git</code>, etc).
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the <code>.vscode/extensions.json</code> file to the root of the project in order to add VS Code extensions if the editor is Theia (the default) or VS Code:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "recommendations": [
    "redhat.java"
  ]
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The list of VS Code extensions is available in the Eclipse&#160;Che plug-in registry.
If the specified extensions are not available in the registry, the workspace will start, but the extensions will not be added to the workspace.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the <code>.vscode/launch.json</code> file for specifying <code>Run</code> and <code>Debug</code> commands if the editor is Theia or VS Code:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "version": "0.2.0",
    "configurations": [
        {
            "type": "java",
            "name": "Debug (Attach) - Remote",
            "request": "attach",
            "hostName": "localhost",
            "port": 5005
        }
    ]
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the <code>.che/che-theia-plugins.yaml</code> file if extra customizations of Theia plugins are required.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Eclipse&#160;Che uses <code>.che/che-theia-plugins.yaml</code> file only if the editor is Theia.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, overriding the default memory limit of <code>redhat.java</code> sidecar container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">- id: redhat/java
  override:
    sidecar:
      memoryLimit: 2Gi</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the <code>.che/che-editor.yaml</code> file to override the default editor (Theia) with a different one (e.g. VS Code or JetBrains IntelliJ) and specify the editor container properties. For example, overriding the default memory limit of the <code>theia-ide</code> container:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">id: eclipse/che-theia/latest          # mandatory
registryUrl: https://my-registry.com  # optional
override:                             # optional
  containers:
    - name: theia-ide
      memoryLimit: 1280Mi</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the Eclipse&#160;Che badge to the project <code>README.md</code> file with a link for starting a workspace:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.eclipse.org/che/contribute.svg" alt="Contribute Badge">
</div>
<div class="title">Figure 9. The official Eclipse&#160;Che badge</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><code>[![Contribute](<a href="https://www.eclipse.org/che/contribute.svg" class="bare">https://www.eclipse.org/che/contribute.svg</a>)](https://che-host#https://github.com/my/repository)</code></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Once the line above is added to the <code>README.md</code>, it will be possible to start a workspace by simply clicking on the badge icon.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Eclipse&#160;Che images from <a href="https://simpleicons.org/?q=eclipse-che">Simple Icons</a> can be also used for generation of the custom badges via <a href="https://shields.io/">Shields IO</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>https://img.shields.io/static/v1?label=eclipse&amp;message=che&amp;logo=eclipseche
https://img.shields.io/static/v1?label=code%20with&amp;message=che&amp;logo=eclipseche&amp;color=FDB940&amp;labelColor=525C86
https://img.shields.io/static/v1?label=eclipse&amp;message=che&amp;logo=eclipseche&amp;color=FDB940&amp;labelColor=525C86&amp;style=plastic
https://img.shields.io/static/v1?label=eclipse&amp;message=che&amp;logo=eclipseche&amp;color=FDB940&amp;labelColor=525C86&amp;style=flat-square
https://img.shields.io/static/v1?label=eclipse&amp;message=che&amp;logo=eclipseche&amp;style=social</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="https://img.shields.io/static/v1?label=eclipse&message=che&logo=eclipseche" alt="Contribute Badge">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="https://img.shields.io/static/v1?label=code%20with&message=che&logo=eclipseche&color=FDB940&labelColor=525C86" alt="Contribute Badge">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="https://img.shields.io/static/v1?label=eclipse&message=che&logo=eclipseche&color=FDB940&labelColor=525C86&style=plastic" alt="Contribute Badge">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="https://img.shields.io/static/v1?label=eclipse&message=che&logo=eclipseche&color=FDB940&labelColor=525C86&style=flat-square" alt="Contribute Badge">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="https://img.shields.io/static/v1?label=eclipse&message=che&logo=eclipseche&style=social" alt="Contribute Badge">
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set up <a href="https://github.com/marketplace/actions/try-in-web-ide">Try in Web IDE</a> GitHub action in the repository in order to test and review pull requests with Eclipse&#160;Che.
More details about the GitHub action can be found in the <a href="https://che.eclipseprojects.io/2021/10/18/@david.kwon-test-pull-requests-with-the-try-in-web-ide-github-action.html">Test pull requests with the Try in Web IDE GitHub action</a> blog post.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now you are all set. Happy Coding!</p>
</div>
</div>]]></content><author><name>Ilya Buziuk</name></author><summary type="html"><![CDATA[The article describes how to easily contribute to a project using Eclipse Che]]></summary></entry><entry><title type="html">Authoring a URL to start a workspace</title><link href="https://che.eclipseprojects.io/2021/12/20/@florent.benoit-authoring-a-url-to-start-a-workspace.html" rel="alternate" type="text/html" title="Authoring a URL to start a workspace" /><published>2021-12-20T00:00:00+00:00</published><updated>2021-12-20T00:00:00+00:00</updated><id>https://che.eclipseprojects.io/2021/12/20/@florent.benoit/authoring-a-url-to-start-a-workspace</id><content type="html" xml:base="https://che.eclipseprojects.io/2021/12/20/@florent.benoit-authoring-a-url-to-start-a-workspace.html"><![CDATA[<div class="paragraph">
<p>As a user, you can create a workspace using a direct URL rather than navigating the user dashboard.
This blog post describes how to author a URL to start a workspace.
The coordinates are organized into the standard sequence shown below.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../../assets/img/start-a-workspace/start-workspace-link.png"><img src="../../../assets/img/start-a-workspace/start-workspace-link.png" alt="Authoring a URL to start a workspace"></a>
</div>
</div>
<div class="paragraph">
<p>To use a URL to start a workspace you can choose to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Paste the URL in the address bar of your browser.</p>
</li>
<li>
<p>Distribute the URL as a link (in an onboarding procedure, in a pull request comment).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you click on a URL to start a workspace, Eclipse&#160;Che:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creates or reuses a workspace. A parameter can request to always create a new workspace.</p>
</li>
<li>
<p>Clones the repository.</p>
</li>
<li>
<p>Searches for a devfile in the given repository. A parameter can override the default location: <code>.devfile.yaml</code> or <code>devfile.yaml</code>. The devfile describes the containers and commands to use for that project. See the <a href="https://devfile.io/">Devfile Documentation</a>. Omitting this file will result in a default container, which provides different languages (including Java, Node.js, Python, PHP, Golang, etc) and tools (including <code>curl</code>, <code>jq</code>, <code>yq</code>, etc).</p>
</li>
<li>
<p>Starts the containers to use for that project.</p>
</li>
<li>
<p>Starts the IDE. A parameter can override the default IDE.</p>
</li>
</ol>
</div>
<div class="sect1">
<h2 id="url-parameters-reference">URL parameters reference</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Mandatory repository parameter:</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#<em>&lt;repository_URL&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repository URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#https://github.com/eclipse-che/che-server/tree/7.40.x</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Optional parameters: (<code>?</code> followed by <code>keyword=value</code>)</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>che-editor=<em>&lt;ide&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>?che-editor=eclipse/che-theia/latest</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>devfilePath=<em>&lt;devfile&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devfile path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>?devfilePath=.che/my-devfile.yaml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>new</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always create a new workspace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>?new</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note: <code>?new</code> keyword has no value</p>
</div>
<div class="paragraph">
<p>In the last part of the URL, parameter list preceded by ? and using the &amp; separator.</p>
</div>
<div class="paragraph">
<p><em><a href="https://che-host" class="bare">https://che-host</a></em>#<em>&lt;repository_url&gt;</em>?<em>&lt;parameter_1&gt;</em>&amp;<em>&lt;parameter_2&gt;</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="defining-the-git-repository-url">Defining the Git repository URL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This syntax is available when using DevWorkspace Operator.</p>
</div>
<div class="paragraph">
<p>The Git repository URL is mandatory.
Che supports following Git providers: GitHub, GitLab, or on-premise Bitbucket.</p>
</div>
<div class="paragraph">
<p>Add a <code>#</code> character and append the repository URL: <code>#<em>&lt;repository_URL&gt;</em></code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Open Eclipse Che Server repository in Eclipse Che hosted by Red Hat</div>
<div class="content">
<div class="paragraph">
<p><a href="https://workspaces.openshift.com#https://github.com/eclipse-che/che-server" class="bare">https://workspaces.openshift.com#https://github.com/eclipse-che/che-server</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="url-syntax-by-git-provider">URL syntax by Git provider</h3>
<div class="paragraph">
<p>URL syntax for cloning GitHub-hosted repositories to the starting workspace:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To clone the default branch on GitHub to the starting workspace:</p>
<div class="paragraph">
<p><code>#https://github.com/<em>&lt;user_or_org&gt;</em>/<em>&lt;repository&gt;</em></code></p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Cloning the default branch of the <a href="https://github.com/eclipse-che/che-plugin-registry">Plug-in registry repository</a>.</div>
<div class="content">
<div class="paragraph">
<p><code>#https://github.com/eclipse-che/che-plugin-registry</code></p>
</div>
</div>
</div>
</li>
<li>
<p>To clone a specified branch on GitHub to the starting workspace:</p>
<div class="paragraph">
<p><code>#https://github.com/<em>&lt;user_or_org&gt;</em>/<em>&lt;repository&gt;</em>/tree/<em>&lt;branch-name&gt;</em></code></p>
</div>
<div class="exampleblock">
<div class="title">Example 3. Cloning the <code>7.39.x</code> branch of the <a href="https://github.com/eclipse-che/che-plugin-registry">Plug-in registry repository</a>.</div>
<div class="content">
<div class="paragraph">
<p><code>#https://github.com/eclipse-che/che-plugin-registry/tree/7.39.x</code></p>
</div>
</div>
</div>
</li>
<li>
<p>To clone the branch of a pull request on GitHub to the starting workspace:</p>
<div class="paragraph">
<p><code>#https://github.com/<em>&lt;user_or_org&gt;</em>/<em>&lt;repository&gt;</em>/pull/<em>&lt;pull-request-id&gt;</em></code></p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Cloning the <a href="https://github.com/eclipse-che/che-plugin-registry/pull/1097">Plug-in registry repository pull request <code>#1097</code></a>.</div>
<div class="content">
<div class="paragraph">
<p><code>#https://github.com/eclipse-che/che-plugin-registry/pull/1097</code></p>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>URL syntax for cloning GitLab-hosted repositories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To clone the default branch on GitLab to the starting workspace:</p>
<div class="paragraph">
<p><code>#https://gitlab.com/<em>&lt;user_or_org&gt;</em>/<em>&lt;repository&gt;</em></code></p>
</div>
</li>
<li>
<p>To clone a specified branch on GitLab to the starting workspace:</p>
<div class="paragraph">
<p><code>#https://gitlab.com/<em>&lt;user_or_org&gt;</em>/<em>&lt;repository&gt;</em>/-/tree/<em>&lt;branch&gt;</em></code></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>URL syntax for cloning BitBucket-hosted repositories:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Eclipse&#160;Che supports only on premises BitBucket instances.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="defining-the-editor-or-integrated-development-environment-ide">Defining the editor or Integrated Development Environment (IDE)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Eclipse&#160;Che starts workspaces with a default IDE: Che Theia.</p>
</div>
<div class="paragraph">
<p>Overriding the default editor is possible with the <code>?che-editor=<em>&lt;editor-id&gt;</em></code> parameter. The <code>editor-id</code> comes from the identifier of the IDE in the plug-in registry.</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Using the next version of Theia (build after each commit)</div>
<div class="content">
<div class="paragraph">
<p><code>https://che-host#https://github.com/example/foo?che-editor=eclipse/che-theia/next</code></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Some available IDE keys:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>eclipse/che-theia/latest</code></p>
</li>
<li>
<p><code>eclipse/che-theia/next</code></p>
</li>
<li>
<p><code>che-incubator/intellij-community/latest</code></p>
</li>
<li>
<p><code>che-incubator/pycharm/latest</code></p>
</li>
<li>
<p><code>che-incubator/che-code/insiders</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Obtain IDE keys from the plug-in registry by looking at <code>Che Editor</code> type entries.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><code>https://che-host/che-plugin-registry/main/index.json</code></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The parameter <code>?che-editor</code> accepts a link to the devfile hosted on a public server (with Cross-Origin Resource Sharing (CORS) enabled).</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><code>https://che-host#https://github.com/example/foo?che-editor=https://eclipse-che.github.io/che-plugin-registry/main/v3/plugins/che-incubator/che-code/insiders/devfile.yaml</code></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-a-different-devfile-file-from-the-repository">Using a different devfile file from the repository</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the devfile file name is different from the default search pattern, which is <code>.devfile.yaml</code> or <code>devfile.yaml</code>, it is possible to override that name.</p>
</div>
<div class="paragraph">
<p>Use the parameter <code>?devfilePath=mydevfile.yaml</code> at the end of <code><a href="https://che-host#" class="bare">https://che-host#</a><em>&lt;git_repository_url&gt;</em></code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><code>https://che-host#https://github.com/example/foo?devfilePath=mydevfile.yaml</code></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The short name for the <code>devfilePath</code> parameter is <code>df</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><code>https://che-host#https://github.com/example/foo?df=mydevfile.yaml</code></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-or-reusing-a-workspace">Creating or reusing a workspace</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you enter a URL such as <code>https://che-host#http://github.com/foo/bar</code> and you don’t have any workspace named <code>bar</code>, Eclipse&#160;Che creates a workspace named <code>bar</code> and clones the GitHub repository.</p>
</div>
<div class="paragraph">
<p>Each time you enter a URL such as <code><a href="https://che-host#http://github.com/foo/bar" class="bare">https://che-host#http://github.com/foo/bar</a></code> again, Eclipse&#160;Che reopens the existing workspace <code>bar</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="always-creating-a-new-workspace">Always creating a new workspace</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To create another workspace each time you enter the same URL, enter the URL appended with <code>?new</code> in the URL format <code>https://che-host#http://github.com/foo/bar?new</code>. Even if you already have a workspace named <code>bar</code>, each time you enter such URL, Eclipse&#160;Che will create another, sequentially named workspace (example: <code>bar-abcde</code>).</p>
</div>
</div>
</div>]]></content><author><name>Florent Benoit</name></author><summary type="html"><![CDATA[How to start a workspace by customizing the URL.]]></summary></entry><entry><title type="html">Test pull requests with the Try in Web IDE GitHub action</title><link href="https://che.eclipseprojects.io/2021/10/18/@david.kwon-test-pull-requests-with-the-try-in-web-ide-github-action.html" rel="alternate" type="text/html" title="Test pull requests with the Try in Web IDE GitHub action" /><published>2021-10-18T00:00:00+00:00</published><updated>2021-10-18T00:00:00+00:00</updated><id>https://che.eclipseprojects.io/2021/10/18/@david.kwon/test-pull-requests-with-the-try-in-web-ide-github-action</id><content type="html" xml:base="https://che.eclipseprojects.io/2021/10/18/@david.kwon-test-pull-requests-with-the-try-in-web-ide-github-action.html"><![CDATA[<p><em>Cross posted from the <a href="https://developers.redhat.com/articles/2021/10/07/test-pull-requests-try-web-ide-github-action#integrate_the_try_in_web_ide_action_with_your_github_repository">Red Hat Developer blog</a>.</em></p>

<p>Web-based, cloud-hosted integrated development environments (IDEs) can make development and collaboration more efficient if they are well integrated with version control. This blog post shows you how to use the <a href="https://github.com/marketplace/actions/try-in-web-ide">Try in Web IDE GitHub action</a> to make it easier for collaborators to test pull requests on <a href="https://www.eclipse.org/che/docs/che-7/hosted-che/hosted-che/">Eclipse Che hosted by Red Hat</a>.</p>

<p>Note: The instance of Eclipse Che used by the Try in Web IDE GitHub action can be configured. The default instance is <a href="https://workspaces.openshift.com">workspaces.openshift.com</a> (Eclipse Che hosted by Red Hat).</p>

<h2 id="the-try-in-web-ide-github-action">The Try in Web IDE GitHub action</h2>
<p>The Try in Web IDE GitHub action makes it easy to try a pull request in your browser-based developer environment. The GitHub action listens to pull request events and provides a comment or status check with a link. When you click the link, it opens the branch in a new web IDE workspace.</p>

<p>The <a href="https://github.com/eclipse/che-docs">Eclipse Che documentation</a> repository has recently integrated this GitHub action into its workflow. You can view a recent pull request to try it yourself. Figure 1 shows a pull request comment created by the GitHub action. Clicking the badge opens a new workspace to try the pull request in the web browser.</p>

<p><img src="https://che.eclipseprojects.io//assets/img/test-pull-requests-with-the-try-in-web-ide-github-action/comment.png" alt="GitHub PR comment with badge to open PR branch in new workspace" />
<span style="color:grey"><em>Figure 1: Clicking the badge opens a web IDE workspace for testing the pull request.</em></span></p>

<p>Figure 2 shows a status check done by the GitHub action. Clicking the Details link opens a new workspace to try the pull request in the web browser.</p>

<p><img src="https://che.eclipseprojects.io//assets/img/test-pull-requests-with-the-try-in-web-ide-github-action/status-check.png" alt="GitHub PR status check with link to open PR branch in new workspace" />
<span style="color:grey"><em>Figure 2: Clicking the Details link opens a web IDE workspace for testing the pull request.</em></span></p>

<p>Figure 3 shows the workspace created in Eclipse Che hosted by Red Hat. This is the web IDE workspace that opens in the web browser when you click either the badge from Figure 1 or the link from Figure 2. From here, you can try the pull request and test its correctness.</p>

<p><img src="https://che.eclipseprojects.io//assets/img/test-pull-requests-with-the-try-in-web-ide-github-action/crw.png" alt="PR branch opened in a new workspace" />
<span style="color:grey"><em>Figure 3: Try the pull request and test its correctness.</em></span></p>

<h2 id="integrate-the-try-in-web-ide-action-with-your-github-repository">Integrate the Try in Web IDE action with your GitHub repository</h2>
<p>This section shows you how to add the Try in Web IDE GitHub action to your GitHub repository’s workflow. We will configure the action to automatically create a comment (Figure 1) and status check (Figure 2) on new pull requests.</p>

<h3 id="prerequisites-and-setup">Prerequisites and setup</h3>
<p>You will need a Red Hat account to use Eclipse Che hosted by Red Hat. Navigate to <a href="https://developers.redhat.com/developer-sandbox">Developer Sandbox for Red Hat OpenShift</a>, register for a free account, and launch your Developer Sandbox environment. Note that you must verify your identity with a phone number.</p>

<p>You also need an account on GitHub and a repository where you can integrate GitHub actions.</p>

<p>Finally, although not mandatory, you can add a <a href="https://www.eclipse.org/che/docs/che-7/end-user-guide/authoring-devfiles-version-1/">devfile</a> in the root of your GitHub repository to specify the features of the development environment and IDE. We’ll use the devfile very shortly.</p>

<h3 id="step-1-create-the-github-workflow-file">Step 1: Create the GitHub workflow file</h3>
<p>In your GitHub repository, create a <code class="language-plaintext highlighter-rouge">.github/workflows</code> directory if it does not exist already. Then, create a file named <code class="language-plaintext highlighter-rouge">example.yml</code> in <code class="language-plaintext highlighter-rouge">.github/workflows</code> with the following content:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Try in Web IDE example</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">pull_request_target</span><span class="pi">:</span>
    <span class="c1"># Triggers workflow on pull request open</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">add-link</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-20.04</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Web IDE Pull Request Check</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">try-in-web-ide</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">redhat-actions/try-in-web-ide@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="c1"># GitHub action inputs</span>

          <span class="c1"># required</span>
          <span class="na">github_token</span><span class="pi">:</span> <span class="s">$</span>

          <span class="c1"># optional - defaults to true</span>
          <span class="na">add_comment</span><span class="pi">:</span> <span class="no">true</span>

          <span class="c1"># optional - defaults to true</span>
          <span class="na">add_status</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>This file defines a workflow named <code class="language-plaintext highlighter-rouge">Try in Web IDE example</code>, with a job that runs the <code class="language-plaintext highlighter-rouge">v1</code> version of the Try in Web IDE GitHub action. The workflow is triggered on the <a href="https://docs.github.com/en/actions/learn-github-actions/events-that-trigger-workflows"><code class="language-plaintext highlighter-rouge">pull_request_target</code></a> event on the <code class="language-plaintext highlighter-rouge">opened</code> activity type.</p>

<h3 id="step-2-configure-the-github-workflow-file">Step 2: Configure the GitHub workflow file</h3>
<p>You can further configure the workflow defined in <code class="language-plaintext highlighter-rouge">example.yml</code> to fit your needs. Consider adding more activity types within the <code class="language-plaintext highlighter-rouge">on.pull_request_target.types</code> field. Alongside the <code class="language-plaintext highlighter-rouge">opened</code> event, other events that you might find useful are <code class="language-plaintext highlighter-rouge">reopened</code> (which is triggered when the pull request is reopened) and <code class="language-plaintext highlighter-rouge">synchronize</code> (which is triggered when the pull request’s tracking branch synchronizes with its source branch). The new types are added in the following code snippet:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">...</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">pull_request_target</span><span class="pi">:</span>
    <span class="c1"># Add multiple activity types</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">,</span> <span class="nv">reopened</span><span class="pi">,</span> <span class="nv">synchronize</span><span class="pi">]</span>

<span class="nn">...</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">add_comment</code> and <code class="language-plaintext highlighter-rouge">add_status</code> GitHub action inputs can also be configured to customize whether the comment or status check is created in the pull request. For example, the following code snippet disables pull request comments:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="s">...</span>

        <span class="s">with</span><span class="err">:</span>
          <span class="na">github_token</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
          <span class="na">add_comment</span><span class="pi">:</span> <span class="no">false</span>
          <span class="na">add_status</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>
<p>The full table of inputs is available in the Try in Web IDE GitHub action <a href="https://github.com/marketplace/actions/try-in-web-ide#action-inputs">documentation</a>.</p>

<h3 id="step-3-optional-create-a-devfile">Step 3 (optional): Create a devfile</h3>
<p>To define the development environment of the web IDE workspace, creating a devfile in the root of the repository is highly recommended. Configuring a devfile ensures that the workspace contains everything you need to effectively try and test the pull request, such as plug-ins, development commands, Kubernetes objects, and other aspects of the environment setup.</p>

<p>For example, specifying the Red Hat Java plug-in in the devfile provides features that Java developers use (for things like debugging, code completion, and so on) within the web IDE workspace.</p>

<p>Here is an example of a minimal devfile.yml file for a Java project:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">1.0.0</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">project-dev-environment</span>
<span class="na">projects</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">project-name-here</span>
    <span class="na">source</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">git</span>
      <span class="na">location</span><span class="pi">:</span> <span class="s1">'</span><span class="s">GITHUB</span><span class="nv"> </span><span class="s">REPOSITORY</span><span class="nv"> </span><span class="s">URL</span><span class="nv"> </span><span class="s">HERE'</span>
<span class="na">components</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">chePlugin</span>
    <span class="na">id</span><span class="pi">:</span> <span class="s">redhat/java/latest</span>
</code></pre></div></div>

<p>This devfile defines the project name and source location, as well as the Java plug-in. Many more <a href="https://www.eclipse.org/che/docs/che-7/end-user-guide/authoring-devfiles-version-1/#adding-components-to-a-devfile_che">components</a> can be added in a devfile to fine-tune the development environment for your specific project.</p>

<h2 id="conclusion">Conclusion</h2>
<p>After you have completed the steps in this blog post, creating a new pull request will trigger the Try in Web IDE GitHub action and create a comment, status check, or both, depending on how you’ve configured the action inputs. With a Red Hat account, you can now try pull requests in a web-based IDE with the click of a link.</p>]]></content><author><name>David Kwon</name></author><summary type="html"><![CDATA[How to integrate the Try in Web IDE GitHub action to your GitHhub repository, making it easier for collaborators to test pull requests in Red Hat CodeReady Workspaces.]]></summary></entry><entry><title type="html">Devfile v2 and the DevWorkspace Operator - Part 1</title><link href="https://che.eclipseprojects.io/2021/10/12/@mario.loriedo-devfile-v2-and-the-devworkspace-operator-p1.html" rel="alternate" type="text/html" title="Devfile v2 and the DevWorkspace Operator - Part 1" /><published>2021-10-12T00:00:00+00:00</published><updated>2021-10-12T00:00:00+00:00</updated><id>https://che.eclipseprojects.io/2021/10/12/@mario.loriedo/devfile-v2-and-the-devworkspace-operator-p1</id><content type="html" xml:base="https://che.eclipseprojects.io/2021/10/12/@mario.loriedo-devfile-v2-and-the-devworkspace-operator-p1.html"><![CDATA[<p><img src="https://che.eclipseprojects.io//assets/img/devfile-v2-and-the-devworkspace-operator-part1/che-workspace-engines.png" alt="Locally trusted certs" /></p>

<p>With version <a href="https://github.com/eclipse/che/releases/tag/7.28.0">7.28 of Che</a> we have introduced a new workspace engine, <a href="https://github.com/devfile/devworkspace-operator">the DevWorkspace Operator</a>, that supports v2 of the Devfile specification. Although the default engine is still the che-server we plan to replace it with the DevWorkspace in the next few months.</p>

<p>Switching to the DevWorkspace engine has some important consequences. Notably on the authentication subsystem that will be lighter and more flexible, on the workspaces network managed by a central gateway powered by <a href="https://github.com/traefik/traefik">Traefik</a> and simpler configuration options for Che administrators.</p>

<p>This is the first of a series of three articles reviewing the changes introduced with the DevWorkspace. Here we will discuss the changes from the point of view of a Che user. The second part will be about the point of view of a Che administrator. The last part will be dedicated to the DevWorkspace Operator.</p>

<h2 id="how-to-enable-the-devworkspace-operator">How to enable the DevWorkspace Operator</h2>
<p>Che default workspace engine is the che-server. The DevWorkspace engine needs to be explicitly enabled. The following <a href="https://github.com/che-incubator/chectl">chectl</a> command deploys Che on OpenShift configured with the DevWorkspace Operator as workspace engine:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chectl server:deploy <span class="nt">-p</span> openshift <span class="se">\</span>
                     <span class="nt">--workspace-engine</span><span class="o">=</span>dev-workspace
</code></pre></div></div>

<p>The command above works for other Kubernetes distributions too (<code class="language-plaintext highlighter-rouge">-p openshift</code> should be replaced) but, after chectl has completed, the CheCluster CustomResource requires a patch:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># For vanilla Kubernetes only</span>
kubectl patch checluster/eclipse-che <span class="nt">--type</span><span class="o">=</span>merge <span class="nt">-n</span> eclipse-che <span class="se">\ </span>
           <span class="nt">--patch</span> <span class="s1">'{"spec": {"server": { "customCheProperties": {"CHE_INFRA_KUBERNETES_ENABLE__UNSUPPORTED__K8S": "true"}}}}'</span> 
</code></pre></div></div>

<h2 id="changes-from-a-che-user-perspective">Changes from a Che user perspective</h2>

<h3 id="new-devfile-spec-v21">New Devfile spec (v2.1)</h3>

<p>Here is an example of v2.1 Devfile:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">schemaVersion</span><span class="pi">:</span> <span class="s">2.1.0</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">python-hello-world</span>
<span class="na">attributes</span><span class="pi">:</span>
  <span class="na">che-theia.eclipse.org/sidecar-policy</span><span class="pi">:</span> <span class="s">USE_DEV_CONTAINER</span>
<span class="na">components</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">python</span>
    <span class="na">container</span><span class="pi">:</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">quay.io/devfile/base-developer-image:ubi8-7bd4fe3</span>
      <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">venv</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/home/user/.venv</span>
      <span class="na">memoryLimit</span><span class="pi">:</span> <span class="s">512Mi</span>
      <span class="na">mountSources</span><span class="pi">:</span> <span class="no">true</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">venv</span>
    <span class="na">volume</span><span class="pi">:</span>
      <span class="na">size</span><span class="pi">:</span> <span class="s">1G</span>
</code></pre></div></div>

<p>The Devfile specification has gone through the release of v2. Here are a few notable changes:</p>
<ul>
  <li>It is compatible with the specification of a Kubernetes API. The DevWorkspace CRD is an extension of the Kubernetes API and it’s generated from the Devfile specification.</li>
  <li>It removes <a href="https://github.com/eclipse/che/issues/18669">chePlugin and cheEditor component types</a>.</li>
  <li>It introduces the volume component type.</li>
  <li>Events and parent are two new top level devfile properties.</li>
  <li>Besides Che it’s used by the OpenShift Developer Console, <code class="language-plaintext highlighter-rouge">odo</code> and the <a href="https://github.com/devfile/devfile-docker-plugin">Devfile Docker plugin</a>.</li>
</ul>

<p>The documentation for Devfile v2.1 is <a href="https://devfile.io/docs/devfile/2.1.0/user-guide/index.html">https://devfile.io/docs/devfile/2.1.0/</a>. A <a href="https://devfile.io/docs/devfile/2.1.0/user-guide/migrating-to-devfile-v2.html">migration guide from v1 to v2 of the specification</a> is included.</p>

<h3 id="a-new-way-to-specify-the-editor-and-its-plugins">A new way to specify the editor and its plugins</h3>
<p>As mentioned above, version 2 of the Devfile, doesn’t include cheEditor and chePlugins component types anymore.</p>

<p>The recommended way to specify the editor of a workspace is to include the file <code class="language-plaintext highlighter-rouge">.che/che-editor.yaml</code> at the root of the workspace git repository:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">id</span><span class="pi">:</span> <span class="s">eclipse/che-theia/latest</span>          <span class="c1"># mandatory</span>
<span class="na">registryUrl</span><span class="pi">:</span> <span class="s">https://my-registry.com</span>  <span class="c1"># optional</span>
<span class="na">override</span><span class="pi">:</span>                             <span class="c1"># optional</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">theia-ide</span>
      <span class="na">memoryLimit</span><span class="pi">:</span> <span class="s">1280Mi</span>
</code></pre></div></div>

<p>The recommended way to specify a che-theia plugin in a workspace is to include the file <code class="language-plaintext highlighter-rouge">.vscode/extensions.json</code> at the root of the workspace git repository:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"recommendations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"ms-python.python"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>It is also possible to define a Che editor and its plugins inline in Devfile attributes, but that’s recommended only when it is not possible to colocate the devile with the source code. More informations about IDEs plugins with v2 of the Devfile can be found <a href="https://che.eclipseprojects.io/2021/06/23/@florent.benoit-devfile-v2-and-ide-plug-ins.html">in this blog post</a> and at <a href="https://github.com/eclipse/che/issues/18669">https://github.com/eclipse/che/issues/18669</a>.</p>

<h3 id="the-devfile-should-live-at-the-root-of-the-git-repo-not-in-a-registry">The Devfile should live at the root of the git repo, not in a registry</h3>
<p>The recommended place to publish the Devfile is within the project source code. Along with the files that we have just seen above to specify che-theia plugins and the editor:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  |--- devfile.yaml
  |___ .che
         |___ che-editor.yaml
         |___ che-theia-plugins.yaml
  |___ .vscode
         |___ extensions.json
</code></pre></div></div>

<p>Having the Devfile at the root of a repository makes it possible to use a simple factory link to the repository to start the workspace. For example <a href="https://workspaces.openshift.com/#https://github.com/eclipse/che-docs">workspaces.openshift.com/#https://github.com/eclipse/che-docs</a> is a factory link: when a user click on it, a workspace defined by the Devfile in the repo <a href="https://github.com/eclipse/che-docs">github.com/eclipse/che-docs</a> will be started on the public Che instance hosted by Red Hat at workspaces.openshift.com.</p>

<p>Recommending to colocate and evolve a v2 Devfile with the source code has two consequences:</p>
<ul>
  <li>the <code class="language-plaintext highlighter-rouge">project</code> section of a Devfile can be omitted: it’s implicitly set to the git repo where the Devfile lives</li>
  <li>Che samples will include a Devfile at their root (those Devfiles used to be published in the Devfile registry)</li>
</ul>

<h3 id="only-one-running-workspace-per-user">Only one running workspace per user</h3>
<p>A user cannot have more than one running workspace at a time. This limitation is related to the persistent volume strategy (“common”) that is used by Che. The same Volume is mounted by every workspace of the same user. This is implemented using Pods <code class="language-plaintext highlighter-rouge">volumeMounts.subPath</code> property and guarantees that the number of Volumes mounted by Che matches the number of users.</p>

<h2 id="current-limitations-and-timeline">Current limitations and Timeline</h2>

<p>Although most of the work has been completed, Che with the DevWorkspace enabled is not ready for production yet. Here is a list of open issues:</p>
<ul>
  <li><a href="https://github.com/eclipse/che/issues/20501">An admin should be able to specify secrets or config maps that need to be provisioned on each user’s namespace #20501</a></li>
  <li><a href="https://github.com/eclipse/che/issues/20528">Support custom certificates for git hosts for devworkspaces #20528</a></li>
  <li><a href="https://github.com/devfile/devworkspace-operator/issues/614">Support Pod tolerations for DevWorkspace Pods devfile/devworkspace-operator#614</a></li>
  <li><a href="https://github.com/eclipse/che/issues/20362">Che with Devworkspaces should be able to use Dex as identity provider on OIDC enabled k8s #20362</a></li>
  <li><a href="https://github.com/eclipse/che/issues/19341">Create v2 devfiles for Getting Started samples</a></li>
  <li><a href="https://github.com/eclipse/che/issues/20596">Support overriding Che Theia plugins preferences and sidecar through .che/che-theia-plugins.yaml</a></li>
  <li><a href="https://github.com/eclipse/che/issues/20460">Adapt Che-Theia Activity Tracker extension to DevWorkspace mode (idling)</a></li>
</ul>

<p>The complete list of issues and the due date can be tracked on the <a href="https://github.com/eclipse/che/milestone/140">GitHub milestone</a>.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this post we have described how to enable the DevWorkspace engine and reviewed the changes from the point of view of a user of Che.</p>

<p>In the second part of this series we are going to look at the changes from an administrator point of view:</p>
<ul>
  <li>It’s possible to deploy only one Che instance per Kubernetes cluster</li>
  <li>Devfiles are not in the registry anymore</li>
  <li>Keycloak is not required anymore and Che users have to be Kubernetes users</li>
  <li>Simpler configuration: namespace, persistent volumes, network</li>
  <li>Use of external routes not supported</li>
  <li>Metrics</li>
</ul>

<p>The third part of this series will be about the DevWorkspace Operator:</p>
<ul>
  <li>Extending the Kubernetes API to provision Development Environments</li>
  <li>Relationship between the DevWorkspace CRD and the Devfile v2</li>
  <li>Relationship between the DevWorkspace Operator and the OpenShift WebTerminal</li>
  <li>Comparison between the DevWorkspace controller and the che-server:
    <ul>
      <li>single tenant</li>
      <li>no knowledge of IDEs and their extensions</li>
    </ul>
  </li>
  <li>DevWorkspaceTemplate and Plugins</li>
  <li>Auto-mounting Secrets and ConfigMaps</li>
</ul>]]></content><author><name>Mario Loriedo</name></author><summary type="html"><![CDATA[How to enable the DevWorkspace engine and what it means from a user point of view]]></summary></entry><entry><title type="html">Backup and Restore of an Eclipse Che Installation</title><link href="https://che.eclipseprojects.io/2021/07/08/@mmorhun-backup-restore-che-installation.html" rel="alternate" type="text/html" title="Backup and Restore of an Eclipse Che Installation" /><published>2021-07-08T00:00:00+00:00</published><updated>2021-07-08T00:00:00+00:00</updated><id>https://che.eclipseprojects.io/2021/07/08/@mmorhun/backup-restore-che-installation</id><content type="html" xml:base="https://che.eclipseprojects.io/2021/07/08/@mmorhun-backup-restore-che-installation.html"><![CDATA[<h3 id="introduction">Introduction</h3>

<p>Any application that runs in production should be backed up regularly.
Even if the application runs inside a Kubernetes or Openshift cluster.
To back up an application in a Kubernetes cluster, a user should back up all the resources and definitions that the application uses.
It could be pretty easy in case when the application is, for example, a deployment with attached volume.
But what if the application has a lot of objects to back up?
In such case the task becomes more complicated and requires an understanding on how the components of the application work and interact with each other.
Or… just back up the whole cluster, however, such approach has a lot of overhead.</p>

<p>To address this problem in <a href="https://www.eclipse.org/che/">Eclipse Che</a>, the backup and restore feature was implemented.
With it, an admin doesn’t have to be aware of Eclipse Che internals in order to create a backup or do recovery of Che.
Eclipse Che (Eclipse Che operator to be more precise) can create backups and restore the installation even if a Che installation was completely deleted!
This works only if Che has been installed using the operator (<code class="language-plaintext highlighter-rouge">chectl server:deploy</code> using installers <code class="language-plaintext highlighter-rouge">olm</code> or <code class="language-plaintext highlighter-rouge">operator</code>).</p>

<p>Let me show you how easy the process of backing up and restoring Che is now.
But first, let’s talk about backup servers a bit.</p>

<h3 id="internal-vs-external-backup-server">Internal vs external backup server</h3>

<p>When all data for backup is gathered into a snapshot, then it is encrypted and sent to a backup server.
The backup server should be set up beforehand and be accessible from within the cluster.
This step requires choosing the backup server type and manual configuration of it.</p>

<p>To make life a bit easier, Eclipse Che can automatically set up and configure a backup server in the same cluster.
Such approach requires no additional configuration as everything is automated, but the main downside of it is that backups are stored in the same cluster and even the same namespace as Eclipse Che.</p>

<p>Note, for production use, it is recommended to set up a backup server outside of the cluster.</p>

<h3 id="how-to-back-up-and-restore-che-using-chectl">How to back up and restore Che using chectl</h3>

<h4 id="creating-backups">Creating backups</h4>

<p>To create a backup of Eclipse Che with <a href="https://github.com/che-incubator/chectl#chectl">chectl</a> one should run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>chectl server:backup
</code></pre></div></div>
<p>The command above will create a backup snapshot and send it to the configured backup server.
But if no backup server is configured, Che operator will deploy internal backup server and configure itself to use the server by default.</p>

<p>To use an external backup server (or switch to another one), its URL and backups repository password should be provided, for example:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>checlt server:backup <span class="nt">-r</span> rest:my-backups.domain.net:1234/che-backups <span class="nt">-p</span> encryption-password
</code></pre></div></div>
<p>After execution of the command above, a new backup will be created and sent to the specified backup server.
Also, it will configure Che to use that backup server by default, so for the next backups just <code class="language-plaintext highlighter-rouge">chectl server:backup</code> will be enough.</p>

<p>Note, instead of using <code class="language-plaintext highlighter-rouge">-p</code> flag, it is possible to set <code class="language-plaintext highlighter-rouge">BACKUP_REPOSITORY_PASSWORD</code> environment variable.
Note, losing repository password means losing all the data stored in it as the password is used to decrypt the repository content.</p>

<h4 id="supported-types-of-backup-servers">Supported types of backup servers</h4>

<p>Eclipse Che uses an external tool called <a href="https://restic.net/">restic</a> to manage backup snapshots.
<code class="language-plaintext highlighter-rouge">restic</code> stores backup snapshots in a backup repository, where each snapshot is identified by a hash.
It also can connect to different kinds of servers that provide data storage capabilities.</p>

<p>As of now, Eclipse Che supports the following types of backup servers:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">REST</code></li>
  <li><code class="language-plaintext highlighter-rouge">AWS S3</code> and API compatible</li>
  <li><code class="language-plaintext highlighter-rouge">SFTP</code></li>
</ul>

<p><a href="https://github.com/restic/rest-server#rest-server"><code class="language-plaintext highlighter-rouge">REST</code> backup server</a> is a dedicated server that’s specially designed to be used with <code class="language-plaintext highlighter-rouge">restic</code>.
It supports optional authentication by username and password:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">export </span><span class="nv">REST_SERVER_USERNAME</span><span class="o">=</span>user
<span class="nv">$ </span><span class="nb">export </span><span class="nv">REST_SERVER_PASSWORD</span><span class="o">=</span>password
<span class="nv">$ </span>chectl server:backup <span class="nt">-r</span> rest:http://backups.my-domain.net:1234/che <span class="nt">-p</span> encryption-password
</code></pre></div></div>
<p>Internal backup server is of type <code class="language-plaintext highlighter-rouge">REST</code>.</p>

<p><code class="language-plaintext highlighter-rouge">AWS S3</code> storage and all API compatible implementations can be used as a backup server.
Requires setting <code class="language-plaintext highlighter-rouge">AWS_ACCESS_KEY_ID</code> and <code class="language-plaintext highlighter-rouge">AWS_SECRET_ACCESS_KEY</code> environment variables.
Example:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">export </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>BZK8W5<span class="k">****</span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>JKTa9TKoL<span class="k">*****</span>dH6U+kP
<span class="nv">$ </span>chectl server:backup <span class="nt">-r</span> s3:s3.amazonaws.com/che-bucket <span class="nt">-p</span> password
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">SFTP</code> storage.
It requires providing SSH key for passwordless login.
That could be done by providing the path to the file with the SSH key or the key itself (choose one):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">export </span><span class="nv">SSH_KEY_FILE</span><span class="o">=</span>/home/user/.ssh/sftp.key
<span class="nv">$ </span><span class="c"># export SSH_KEY=-----BEGIN RSA PRIVATE KEY-----*****</span>
<span class="nv">$ </span>chectl server:backup sftp:user@my-host.net:1234//srv/static/che-backups
</code></pre></div></div>

<h4 id="restoring-che-installation-form-a-backup">Restoring Che installation form a backup</h4>

<p>To restore Eclipse Che installation, simply run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>chectl server:restore
</code></pre></div></div>
<p>It will download the latest backup snapshot from the configured backup server and restore all Eclipse Che data from it.
If needed, it will even deploy a new Che cluster and apply data from the backup snapshot.</p>

<p>But what if we created a dozen of backups and want to restore not from the latest backup available on the backup server, but an older one?
It is possible!
Just add backup snapshot ID with <code class="language-plaintext highlighter-rouge">-f</code>  flag to the restore command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>chectl server:restore <span class="nt">-s</span> f801da5c
</code></pre></div></div>
<p>Where to get snapshot IDs?
There are two ways.
Snapshot ID is printed when a backup command executed:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Backup snapshot ID: f801da5c
</code></pre></div></div>
<p>Another way is to use <code class="language-plaintext highlighter-rouge">restic</code> tool:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>restic <span class="nt">-r</span> rest:my-backups.domain.net:1234/che-backups snapshots
</code></pre></div></div>

<p>Also, it is possible to use differnet backup server to restore from.
Just provide a backup server URL and repository password with needed credentials.
For example:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>chectl server:restore <span class="nt">-r</span> sftp:cheuser@my-sftp.domain.net:/srv/data/che-backups/ <span class="nt">-p</span> encryption-password <span class="nt">--ssh-key-file</span><span class="o">=</span>~/.ssh/che-sftp.key
</code></pre></div></div>
<p>Note, that the command above will change default backup server, so the next backup will be sent there unless another configuration provided.</p>

<h3 id="how-to-back-up-and-restore-che-via-custom-resources-objects">How to back up and restore Che via custom resources objects</h3>

<h4 id="concept">Concept</h4>

<p>If someone doesn’t want to use <code class="language-plaintext highlighter-rouge">chectl</code> or want to have more control over the backup and restore process, it is possible to control backup and restore processes by directly managing backup related custom resources (CRs).
There are 3 types of CRs:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">CheBackupServerConfiguration</code> that holds information about a backup server and references to the secrets with credentials.</li>
  <li><code class="language-plaintext highlighter-rouge">CheClusterBackup</code> requests a new backup and also points to an instance of <code class="language-plaintext highlighter-rouge">CheBackupServerConfiguration</code> to where the backup snapshot should be sent.</li>
  <li><code class="language-plaintext highlighter-rouge">CheClusterRestore</code> requests a new restore and holds reference to <code class="language-plaintext highlighter-rouge">CheBackupServerConfiguration</code> from where the backup snapshot should be downloaded.</li>
</ul>

<p>Please note, that only creation of <code class="language-plaintext highlighter-rouge">CheClusterBackup</code> and <code class="language-plaintext highlighter-rouge">CheClusterRestore</code> instances triggers backup and restore processes correspondingly.
Any editing of these resources has no effect.</p>

<p>Under the hood, <code class="language-plaintext highlighter-rouge">chectl</code> deals with the described CRs in order to create a backup or trigger a restore process.</p>

<h4 id="configuring-a-backup-server">Configuring a backup server</h4>

<p>Before backing up or restoring Che installation, at least one backup server configuration should be created.
Also, all secrets that are referenced from the CR must exist.
Then, the configuration might be referenced from backup and/or restore CR.</p>

<p>Example backup server configuration for AWS S3 storage:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">org.eclipse.che/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CheBackupServerConfiguration</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">backup-server-configuration</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">awss3</span><span class="pi">:</span>
    <span class="na">repositoryPath</span><span class="pi">:</span> <span class="s">che-bucket</span>
    <span class="na">repositoryPasswordSecretRef</span><span class="pi">:</span> <span class="s">aws-backup-encryption-password-secret</span>
    <span class="na">awsAccessKeySecretRef</span><span class="pi">:</span> <span class="s">aws-user-credentials-secret</span>
</code></pre></div></div>
<p>Both secrets <code class="language-plaintext highlighter-rouge">aws-backup-encryption-password-secret</code> with <code class="language-plaintext highlighter-rouge">repo-password</code> key and <code class="language-plaintext highlighter-rouge">aws-user-credentials-secret</code> with <code class="language-plaintext highlighter-rouge">awsAccessKeyId</code> and <code class="language-plaintext highlighter-rouge">awsSecretAccessKey</code> keys must exist.</p>

<p>As it was described above, under <code class="language-plaintext highlighter-rouge">spec</code> section only <code class="language-plaintext highlighter-rouge">rest</code>, <code class="language-plaintext highlighter-rouge">awss3</code> and <code class="language-plaintext highlighter-rouge">sftp</code> is allowed.
CR definitions have self-explanatory fields and it will be easy to create a backup server configuration.
But note, that each subsection mutually excludes the others.
However, it is allowed to create as many backup server configurations as needed.</p>

<h4 id="backing-up">Backing up</h4>

<p>To create a new backup, a new CR of <code class="language-plaintext highlighter-rouge">CheClusterBackup</code> type should be created:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">org.eclipse.che/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CheClusterBackup</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">eclipse-che-backup</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">backupServerConfigRef</span><span class="pi">:</span> <span class="s">backup-server-configuration</span>
</code></pre></div></div>
<p>Right after the CR creation a new backup process will be started.
To monitor backup process state, one should look at <code class="language-plaintext highlighter-rouge">status</code> section of the created CR:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get CheClusterBackup eclipse-che-backup <span class="nt">-n</span> eclipse-che <span class="nt">-o</span> yaml | <span class="nb">grep</span> <span class="nt">-A</span> 5 ^status
</code></pre></div></div>
<p>The output of the command above looks like:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">status</span><span class="pi">:</span>
  <span class="na">message</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Backup</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">progress.</span><span class="nv"> </span><span class="s">Start</span><span class="nv"> </span><span class="s">time:</span><span class="nv"> </span><span class="s">&lt;timestamp&gt;'</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">Collecting Che installation data</span>
  <span class="na">state</span><span class="pi">:</span> <span class="s">InProgress</span>
</code></pre></div></div>
<p>where</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">message</code> shows overall human readable status or an error message.</li>
  <li><code class="language-plaintext highlighter-rouge">stage</code> displays human readable current phase of backup process</li>
  <li><code class="language-plaintext highlighter-rouge">state</code> indicates the overall state of the backup. Only <code class="language-plaintext highlighter-rouge">InProgress</code>, <code class="language-plaintext highlighter-rouge">Succeeded</code> and <code class="language-plaintext highlighter-rouge">Failed</code> allowed.</li>
</ul>

<p>When the process finishes successfully, the <code class="language-plaintext highlighter-rouge">status</code> section will contain <code class="language-plaintext highlighter-rouge">snapshotId</code> field that could be used when restoring.
The CR might be deleted after backup is finished.</p>

<p>If one need to request internal backup server and create a backup, <code class="language-plaintext highlighter-rouge">CheClusterBackup</code> with <code class="language-plaintext highlighter-rouge">useInternalBackupServer</code> property set to <code class="language-plaintext highlighter-rouge">true</code> should be created:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">org.eclipse.che/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CheClusterBackup</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">eclipse-che-backup</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">useInternalBackupServer</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>
<p>Note, it will create an instance of <code class="language-plaintext highlighter-rouge">CheBackupServerConfiguration</code> and corresponding secrets automatically.</p>

<h4 id="restoring">Restoring</h4>

<p>To restore from a backup snapshot, a new CR of <code class="language-plaintext highlighter-rouge">CheClusterRestore</code> type should be created:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">org.eclipse.che/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CheClusterRestore</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">eclipse-che-restore</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">backupServerConfigRef</span><span class="pi">:</span> <span class="s">backup-server-configuration</span>
</code></pre></div></div>

<p>By default the latest snapshot is taken.
However, it is possible to restore from a specific snapshot by adding <code class="language-plaintext highlighter-rouge">snapshotId</code> field under <code class="language-plaintext highlighter-rouge">spec</code> section.</p>

<p>To monitor the restore state, one may read status of the corresponding CR:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get CheClusterRestore eclipse-che-restore <span class="nt">-n</span> eclipse-che <span class="nt">-o</span> yaml | <span class="nb">grep</span> <span class="nt">-A</span> 5 ^status
</code></pre></div></div>
<p>Once the restore finishes, the CR can be deleted.</p>

<h3 id="limitations">Limitations</h3>

<p>As of now, there are two major limitations with backup and restore:</p>
<ul>
  <li>Backing up of user’s projects inside workspaces hasn’t been implemented yet. So, all not committed changes will not be restored.</li>
  <li>Backup snapshots are bind to the specific cluster, so it is not possible to restore snapshot on another cluster in general case. This is because Che binds to some cluster ID’s.</li>
</ul>

<p>Other than that, back up and restore is a user friendly and straightforward process now.</p>]]></content><author><name>Mykola Morhun</name></author><summary type="html"><![CDATA[How to create backups and do recovery of Eclipse Che]]></summary></entry><entry><title type="html">Devfile v2 and IDE plug-ins</title><link href="https://che.eclipseprojects.io/2021/06/23/@florent.benoit-devfile-v2-and-ide-plug-ins.html" rel="alternate" type="text/html" title="Devfile v2 and IDE plug-ins" /><published>2021-06-23T00:00:00+00:00</published><updated>2021-06-23T00:00:00+00:00</updated><id>https://che.eclipseprojects.io/2021/06/23/@florent.benoit/devfile-v2-and-ide-plug-ins</id><content type="html" xml:base="https://che.eclipseprojects.io/2021/06/23/@florent.benoit-devfile-v2-and-ide-plug-ins.html"><![CDATA[<h3 id="definition">Definition</h3>

<p>Devfile has been incubated by Eclipse Che project providing <a href="https://redhat-developer.github.io/devfile/">devfile v1 specification</a>.</p>

<p>To allow other projects to use a common definition, devfile has moved out of Eclipse Che. It has its own definition at <a href="https://devfile.io">https://devfile.io</a> with current <a href="https://docs.devfile.io/devfile/2.1.0/user-guide/api-reference.html">v2.1.0 specification</a>.</p>

<p>Devfiles v1 were handled by Eclipse Che Server workspace engine using Java/Kubernetes API. There is a new engine for v2 Devfiles called DevWorkspace Controller. The source code is at: <a href="https://github.com/devfile/devworkspace-operator">https://github.com/devfile/devworkspace-operator</a>.</p>

<p>DevWorkspaces are custom Kubernetes resources and can be created/listed/deleted using any Kubernetes client like <code class="language-plaintext highlighter-rouge">kubectl</code>.</p>

<p>A DevWorkspace is a workspace using the new engine and supporting Devfile v2 definition.</p>

<h3 id="milestones">Milestones</h3>

<p>Devfile v2 support in Eclipse Che can be followed by milestones.</p>

<ul>
  <li><a href="https://github.com/eclipse/che/milestone/136">Milestone 1</a> introduced the first support of Devfile v2 (start a basic workspace)</li>
  <li><a href="https://github.com/eclipse/che/milestone/139">Milestone 2</a> just landed in Eclipse Che 7.32.0 with the support of Theia plug-ins for DevWorkspaces</li>
  <li><a href="https://github.com/eclipse/che/issues/20830">End Game</a> is the End Game issue.</li>
</ul>

<h3 id="how-to-test">How to test ?</h3>

<p>The support of Devfile v2/DevWorkspaces is optional and need to be opt-in.</p>

<p>When the support is enabled, both Devfile v1 and v2 are supported. You can still work with your previous workspaces and Devfile v1.</p>

<ul>
  <li>If the <code class="language-plaintext highlighter-rouge">devfile.yaml</code> has <code class="language-plaintext highlighter-rouge">apiVersion 1.0.0</code>, it will use Che server workspace engine to deploy this Devfile.</li>
  <li>If the <code class="language-plaintext highlighter-rouge">devfile.yaml</code> has <code class="language-plaintext highlighter-rouge">schemaVersion 2.0.0</code> (or greater like <code class="language-plaintext highlighter-rouge">2.1.0</code>), it will use the DevWorkspace controller to deploy this Devfile.</li>
</ul>

<p>⚠️ DevWorkspaces requires OpenShift as platform until Milestone 3 is reached (vanilla Kubernetes is not supported yet)</p>

<p>ℹ️ When DevWorkspace is enabled, single-host deployment is enforced. As a consequence, when the Che host certificate is untrusted, there is no need to locally install it.</p>

<p>To enable DevWorkspaces, use a custom spec object for Che Operator:</p>

<p>Creates a file in your <code class="language-plaintext highlighter-rouge">${HOME}</code> folder for example <code class="language-plaintext highlighter-rouge">${HOME}/enable-devfilev2.yaml</code> with the following content:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spec</span><span class="pi">:</span>  
  <span class="na">devWorkspace</span><span class="pi">:</span>  
    <span class="na">enable</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>Install Eclipse Che (latest stable ≥7.32 or next channel) with chectl:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>chectl update next <span class="c"># (or stable)  </span>
<span class="nv">$ </span>chectl server:deploy <span class="nt">--che-operator-cr-patch-yaml</span><span class="o">=</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/enable-devfilev2.yaml
</code></pre></div></div>

<p>Then, search for the Dashboard link in the chectl output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>✔ Eclipse Che 7.33.0-SNAPSHOT has been successfully deployed.  
  ✔ Documentation        : [https://www.eclipse.org/che/docs/](https://www.eclipse.org/che/docs/)  
  ✔ -------------------------------------------------------------  
  ✔ Users Dashboard      : https://che-eclipse-che.my-che.com/  
  ✔ -------------------------------------------------------------  
</code></pre></div></div>

<p>Opening the Dashboard page will display the new getting started:</p>

<p><img src="https://che.eclipseprojects.io//assets/img/devfile-v2-and-ide-plugins/dashboard-getting-started.png" alt="Getting Started" /></p>

<p>Clicking on a sample will use a Devfile v2 and the DevWorkspace engine.</p>

<p>ℹ️ <a href="https://www.eclipse.org/che/docs/che-7/installation-guide/enabling-dev-workspace-engine/">The installation guide is also available in Eclipse Che documentation</a></p>

<h3 id="updating-from-devfilev1">Updating from Devfile v1</h3>

<p>While the syntax between v1 and v2 yaml definition is close, there is a major change in the DevWorkspace definition: the IDE plug-ins are no longer part of the Devfile.</p>

<p>It brings more clarity: for example, it was possible to include a java plug-in but it was unclear that it required the Eclipse Theia editor and that it would not work with other supported editors. Also, when the Devfile was consumed by other tools like <a href="https://developers.redhat.com/products/odo/overview">odo</a> that don’t have the notion of plugin or editor, those components were ignored.</p>

<p>Another change in the lifecycle of a workspace is that the project clone operation is done by the DevWorkspace engine. So whatever Che editor is picked-up, the project will always be cloned in <code class="language-plaintext highlighter-rouge">/projects/&lt;your-project&gt;</code> location after the workspace start (no matter if there is an editor/IDE or not).</p>

<h3 id="plug-ins-definition">Plug-ins definition</h3>

<h4 id="ide-preferences">IDE preferences</h4>

<p>While IDE plug-ins are no longer part of the <code class="language-plaintext highlighter-rouge">devfile.yaml</code>, instead or reinventing a new file format to specify an IDE plugins, the idea was to leverage the already existing definition files.</p>

<p>For example VS Code has <code class="language-plaintext highlighter-rouge">.vscode/extensions.json</code> file where plug-ins can be recommended.</p>

<p>Eclipse Che now supports this file format and, when it founds one and the editor is Eclipse Theia, it will add the corresponding VS Code extensions to the DevWorkspace.</p>

<p>Specifying</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">  
  </span><span class="nl">"recommendations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"redhat.java"</span><span class="w">  
  </span><span class="p">]</span><span class="w">  
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>in <code class="language-plaintext highlighter-rouge">.vscode/extensions.json</code> will automatically install <code class="language-plaintext highlighter-rouge">redhat/java</code> VS Code extension in the Eclipse Che workspace.</p>

<p>Note: if the specified set of extensions IDs are not available in the Eclipse Che plug-in registry, the workspace creation won’t fail but the extensions won’t be included.</p>

<p>The list of the VS Code extension that can be included in a Che Theia workspace are available on the online registry at <a href="https://eclipse-che.github.io/che-plugin-registry/main/v3/plugins/">https://eclipse-che.github.io/che-plugin-registry/main/v3/plugins/</a>. The registry is continuously updated when PRs get merged on Che plugin registry main branch.</p>

<h4 id="custom-definition">Custom definition</h4>

<p>Relying on <code class="language-plaintext highlighter-rouge">.vscode/extensions.json</code> is great but, to run a VS Code extension as a Kubernetes workload, may require some extra specifications that are not part of this file format.</p>

<p>Here comes the <code class="language-plaintext highlighter-rouge">.che/che-theia-plugins.yaml</code> optional file.</p>

<p>For example, overriding some container settings like the memoryLimit for the <code class="language-plaintext highlighter-rouge">redhat.java</code> plug-in.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">redhat/java</span>  
  <span class="na">override</span><span class="pi">:</span>  
    <span class="na">sidecar</span><span class="pi">:</span>  
      <span class="na">memoryLimit</span><span class="pi">:</span> <span class="s">2Gi</span>
</code></pre></div></div>

<h4 id="inlining">Inlining</h4>

<p>Sometimes it may not be possible to include the files <code class="language-plaintext highlighter-rouge">.vscode/extensions.json</code> or the <code class="language-plaintext highlighter-rouge">.che/che-theia-plugins.yaml</code> in the git repository.</p>

<p>Inlining the content of these files in the <code class="language-plaintext highlighter-rouge">devfile.yaml</code> file is somehow possible using the following syntax of the Devfile:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">schemaVersion</span><span class="pi">:</span> <span class="s">2.1.0</span>  
<span class="na">metadata</span><span class="pi">:</span>  
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-example</span>  
<span class="na">attributes</span><span class="pi">:</span>  
  <span class="na">.vscode/extensions.json</span><span class="pi">:</span> <span class="pi">|</span>  
    <span class="s">{  </span>
      <span class="s">"recommendations": [  </span>
        <span class="s">"redhat.java"  </span>
      <span class="s">]  </span>
    <span class="s">}</span>
</code></pre></div></div>

<p>To inline <code class="language-plaintext highlighter-rouge">.che/che-theia-plugins.yaml</code> :</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="na">schemaVersion</span><span class="pi">:</span> <span class="s">2.1.0</span>  
<span class="na">metadata</span><span class="pi">:</span>  
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-example</span>  
<span class="na">attributes</span><span class="pi">:</span>  
  <span class="na">.che/che-theia-plugins.yaml</span><span class="pi">:</span> <span class="pi">|</span>  
    <span class="s">- id: redhat/java</span>
</code></pre></div></div>

<h3 id="workflow-of-handling-ide-plug-ins-with-workspaces">Workflow of handling IDE plug-ins with workspaces</h3>

<p><img src="https://che.eclipseprojects.io//assets/img/devfile-v2-and-ide-plugins/devfile2-workflow.png" alt="devfile v2 workflow" /></p>

<h3 id="new-features-forplug-ins">New Features for plug-ins</h3>

<p>Although excluding the IDE plug-ins from the Devfile specification represents a big change, each editor can now bring new features more easily. Each editor can directly update a workspace using <code class="language-plaintext highlighter-rouge">DevWorkspaceTemplate</code> objects based on its configuration files (like optional <code class="language-plaintext highlighter-rouge">.vscode/extensions.json</code> or <code class="language-plaintext highlighter-rouge">.che/che-theia-plugins.yaml</code> files).</p>

<h4 id="deploy-plug-ins-in-existing-containers">Deploy plug-ins in existing containers</h4>

<p>By default, in Eclipse Che and when using Eclipse Theia editor, IDE plug-ins were deployed either in the Che-Theia container (when it only requires nodejs runtime) or through a new sidecar container (for example for Java, Go, Python, Php, etc.)</p>

<p>In that case, all plugins requiring a sidecar will be deployed in the <code class="language-plaintext highlighter-rouge">user defined container</code> and not in their specific sidecar container.</p>

<p>Example:</p>

<p>If a repository contains these two files:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">devfile.yaml</code> with the following content:
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">schemaVersion</span><span class="pi">:</span> <span class="s">2.1.0</span>  
<span class="na">metadata</span><span class="pi">:</span>  
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-example</span>  
<span class="na">components</span><span class="pi">:</span>  
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">tools</span>  
 <span class="na">container</span><span class="pi">:</span>  
   <span class="na">image</span><span class="pi">:</span> <span class="s">registry.access.redhat.com/ubi8/openjdk-11</span>  
   <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">tail'</span><span class="pi">]</span>  
   <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">-f'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">/dev/null'</span><span class="pi">]</span>
</code></pre></div>    </div>
  </li>
  <li>And the file <code class="language-plaintext highlighter-rouge">.vscode/extensions.json</code> containing
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">  
</span><span class="nl">"recommendations"</span><span class="p">:[</span><span class="w">
   </span><span class="s2">"redhat.java"</span><span class="w">  
</span><span class="p">]</span><span class="w">  
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ol>

<p>The plug-in <code class="language-plaintext highlighter-rouge">redhat.java</code> will be started inside the tools container and in its own sidecar container.</p>

<p>For this to work the tools container should include the plug pre-requisites otherwise the VS Code java extension will fail to start.</p>

<p>To disable this behaviour, use the following attribute:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">attributes</span><span class="pi">:</span>  
  <span class="na">che-theia.eclipse.org/sidecar-policy</span><span class="pi">:</span> <span class="s">mergeImage</span>
</code></pre></div></div>

<h4 id="prebuilt-devworkspace-templates">Prebuilt DevWorkspace templates</h4>

<p>With Devfile v1 the flow was the following: a user selects a getting started example, the Dashboard fetches the Devfile, the plug-in broker analyzes the <code class="language-plaintext highlighter-rouge">devfile.yaml</code> fetches the content from linked plug-in registries, parses the <code class="language-plaintext highlighter-rouge">meta.yaml</code> of these plug-ins, extracts the sidecar containers definitions and, finally, adds some containers to the workspace definition.</p>

<p>With Devfile v2, these steps with a lot of yaml/json transformations are still present but the output result is a set of DevWorkspace templates that will be applied on the Kubernetes cluster.</p>

<p>Those DevWorkspace templates can be generated at build time rather than at runtime. The Che-Theia library, with a Devfile provided as input (the optional <code class="language-plaintext highlighter-rouge">.vscode/extensions.json</code> and <code class="language-plaintext highlighter-rouge">.che/che-theia-plugins.yaml</code> files), generates a yaml file that includes the definition of the DevWorkspace templates.</p>

<p>npx @eclipse-che/che-theia-devworkspace-handler –devfile-url:<a href="https://github.com/che-samples/spring-petclinic/tree/devfilev2">https://github.com/che-samples/spring-petclinic/tree/devfilev2</a> –output-file:$(pwd)/all-in-one.yaml</p>

<p>Then this file can be used directly by <code class="language-plaintext highlighter-rouge">kubectl</code> :</p>

<p><code class="language-plaintext highlighter-rouge">kubectl apply -f all-in-one.yaml -n my-namespace</code></p>

<p>These templates can be included in the Devfile registry and the Eclipse Che Dashboard will apply them directly instead of processing the original Devfile at every workspace start.</p>

<h3 id="plug-in-registrychanges">Plug-in registry changes</h3>

<p>For workspaces using Devfile v1, Eclipse Che server fetches a <code class="language-plaintext highlighter-rouge">meta.yaml</code> files from the plug-in registry. There are some limitations, for example defining plug-in preferences is only possible if there is a sidecar being defined, etc.</p>

<p>With DevWorkspaces, the plug-in registry export now the content provided in different formats. It still exports <code class="language-plaintext highlighter-rouge">meta.yaml</code> files but it also exposes <code class="language-plaintext highlighter-rouge">devfile.yaml</code> files for Eclipse Che editors definition and for some plug-ins that are not IDE plug-ins like che-machine-exec (library to be able connect to a specific container in a workspace/pod).</p>

<p>Also the Che-Theia IDE plug-ins are now exposed by their <code class="language-plaintext highlighter-rouge">che-theia-plugin.yaml</code> fragment.</p>

<p>Every Che-Theia plug-in fragment is generated from the <a href="https://github.com/eclipse-che/che-plugin-registry/blob/main/che-theia-plugins.yaml">che-theia-plugins.yaml file</a>.</p>

<p>An hosted version of the che-plugin-registry is available after each commit at <a href="https://eclipse-che.github.io/che-plugin-registry/main">https://eclipse-che.github.io/che-plugin-registry/main</a></p>

<p>Corresponding definition for<code class="language-plaintext highlighter-rouge">redhat/java</code> IDE plug-in is available at:</p>

<p><a href="https://eclipse-che.github.io/che-plugin-registry/main/v3/plugins/redhat/java/latest/che-theia-plugin.yaml">https://eclipse-che.github.io/che-plugin-registry/main/v3/plugins/redhat/java/latest/che-theia-plugin.yaml</a></p>

<p>It references the dependencies of this IDE plug-in and its preferences (whereas with <code class="language-plaintext highlighter-rouge">meta.yaml</code> the notion of dependency didn’t exist and all the required <code class="language-plaintext highlighter-rouge">.vsix</code> had to be specified in the file)</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">preferences</span><span class="pi">:</span>  
  <span class="na">java.server.launchMode</span><span class="pi">:</span> <span class="s">Standard</span>  
<span class="na">dependencies</span><span class="pi">:</span>  
  <span class="pi">-</span> <span class="s">vscjava/vscode-java-debug</span>  
  <span class="pi">-</span> <span class="s">vscjava/vscode-java-test</span>
</code></pre></div></div>

<h3 id="eclipse-che-devfile-registrychanges">Eclipse Che Devfile registry changes</h3>

<p>The index of the Devfile registry is providing a list of Devfiles to use. But now, Devfile v2 as some other optional files may be required, it’s better to reference a repository rather than a single <code class="language-plaintext highlighter-rouge">devfile.yaml</code>.</p>

<p>New links are available in the Devfile registry. The <code class="language-plaintext highlighter-rouge">v2</code> links are links to either repositories or devfiles.</p>

<p>Here is an example of a minimal index of a Devfile registry:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"displayName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Java Spring Boot"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/images/springboot.svg"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"v2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/che-samples/java-spring-petclinic/tree/devfilev2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/devfiles/java-web-spring/devfile.yaml"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>If the DevWorkspaces is enabled and there are some v2 links in the Devfile registry, only Devfile v2 getting started will be shown on the Dashboard (Devfile v1 getting started will be hidden). Each of these samples will use the new DevWorkspace engine.</p>

<p><img src="https://che.eclipseprojects.io//assets/img/devfile-v2-and-ide-plugins/dashboard-getting-started.png" alt="Getting Started" /></p>

<p>In addition to those changes, there is an ongoing effort to merge Che Devfile registry and <a href="https://registry.devfile.io">community Devfile registry</a>. This work is part of the <a href="https://github.com/devfile/registry">Devfile project</a> that is planned to become <a href="https://github.com/devfile/api/issues/426">a CNCF sandbox project</a>.</p>]]></content><author><name>Florent Benoit</name></author><summary type="html"><![CDATA[How are IDE plug-ins handled with devfile v2]]></summary></entry><entry><title type="html">Use mkcert to Trust Local Che Certificates</title><link href="https://che.eclipseprojects.io/2021/01/07/@mario.loriedo-use-mkcert-to-trust-local-che-certificates.html" rel="alternate" type="text/html" title="Use mkcert to Trust Local Che Certificates" /><published>2021-01-07T00:00:00+00:00</published><updated>2021-01-07T00:00:00+00:00</updated><id>https://che.eclipseprojects.io/2021/01/07/@mario.loriedo/use-mkcert-to-trust-local-che-certificates</id><content type="html" xml:base="https://che.eclipseprojects.io/2021/01/07/@mario.loriedo-use-mkcert-to-trust-local-che-certificates.html"><![CDATA[<p><img src="https://che.eclipseprojects.io//assets/img/mkcert/header.png" alt="Locally trusted certs" /></p>

<p>When deploying Che locally, on minikube for example, its TLS certificate will be self-signed and not trusted by the local browsers.</p>

<p>In this blog post we are going to see how we can generate TLS certificates using <a href="https://mkcert.dev/">mkcert</a> and configure Che to use them. Those certificates will be always locally-trusted.</p>

<h2 id="the-problem-with-untrusted-tls-certificates">The problem with untrusted TLS certificates</h2>

<p>When Che SSL certificate is signed by an unknown CA, the certificate won’t be trusted by the local browser and Che users have to download and locally import the TLS certificate<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup> (<a href="https://www.eclipse.org/che/docs/che-7/installation-guide/installing-che-on-minikube/#importing-certificates-to-browsers_che">we have even documemented the instructions for different browsers</a>).</p>

<p>Locally importing a CA certificate is a repetitive and error prone task. A new CA certificate needs to be imported at every local Che install. That’s annyoing, especially if like me you deploy Che often.</p>

<p>Someone may argue that with <a href="https://letsencrypt.org/">Let’s Encrypt</a> or <a href="https://zerossl.com/">ZeroSSL</a> issueing a valid certificates is straighforward. But that won’t for <code class="language-plaintext highlighter-rouge">localhost</code> or <code class="language-plaintext highlighter-rouge">nip.io</code>.</p>

<p>We could automate the import of the certificate at the end of every Che deploy too. But, instead of reinventing the wheel, we are going to use <a href="https://mkcert.dev/">mkcert</a>. That’s a command line tool to manage local TLS certificates:</p>

<blockquote>
  <p>mkcert is a simple tool for making locally-trusted development certificates. It requires no configuration.</p>
</blockquote>

<h2 id="issue-a-locally-trusted-che-certificate">Issue a locally-trusted Che certificate</h2>

<p>The following steps will guide you through the generation of a TLS certificate for Che ingresses signed by a CA that is trusted by your system and browsers.</p>

<h3 id="step1---install-mkcert">STEP1 - Install mkcert</h3>

<p>Instructions to install mkcert are in the GitHub repository <a href="https://github.com/FiloSottile/mkcert#installation">README file</a>.</p>

<h3 id="step2---create-a-local-ca">STEP2 - Create a local CA</h3>

<p>In order to generate a valid certificate we need a trusted Certificate Authority to sign them.</p>

<p>The following <code class="language-plaintext highlighter-rouge">mkcert</code> command generates a CA certificate and key:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mkcert <span class="nt">-install</span>   
Using the <span class="nb">local </span>CA at “/Users/mariolet/Library/Application Support/mkcert” ✨  
The <span class="nb">local </span>CA is already installed <span class="k">in </span>the system trust store! 👍  
The <span class="nb">local </span>CA is already installed <span class="k">in </span>the Firefox trust store! 👍
</code></pre></div></div>

<p>As a result a CA certificate and private key will created in <code class="language-plaintext highlighter-rouge">mkcert</code> data folder <code class="language-plaintext highlighter-rouge">~/Library/Application Support/mkcert/</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-l</span> ~/Library/Application<span class="se">\ </span>Support/mkcert/
total 16
<span class="nt">-r--------</span>  1 mloriedo  staff  2484 Jul 20  2020 rootCA-key.pem
<span class="nt">-rw-r--r--</span>  1 mloriedo  staff  1720 Jul 20  2020 rootCA.pem
</code></pre></div></div>

<p>The CA is trusted by the OS and by my local Firefox.</p>

<p>This is a one time operation as I can use this same CA to sign certificates for different Che deployments, even on different clusters.</p>

<h3 id="step3---retrieve-che-domain-name">STEP3 - Retrieve Che domain name</h3>

<p>Assuming that Che has already been deployed (here are the instructions), the following command is</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ CHE_DOMAIN_NAME</span><span class="o">=</span><span class="si">$(</span>kubectl get ingress <span class="se">\</span>
         <span class="nt">--all-namespaces</span> <span class="se">\</span>
         <span class="nt">-l</span> <span class="s2">"app.kubernetes.io/name"</span><span class="o">=</span><span class="s2">"che"</span> <span class="se">\</span>
         <span class="nt">-l</span> <span class="s2">"app.kubernetes.io/component"</span><span class="o">=</span><span class="s2">"che"</span> <span class="se">\</span>
         <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[*].spec.tls[0].hosts[0]}'</span><span class="si">)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="k">${</span><span class="nv">CHE_DOMAIN_NAME</span><span class="k">}</span>
192.168.64.34.nip.io
</code></pre></div></div>

<p>Note that on <code class="language-plaintext highlighter-rouge">minikube</code> the domain name contains the IP address of the VM (for example <code class="language-plaintext highlighter-rouge">192.168.64.34.nip.io</code>). This step and the following one should be repeated when the IP changes (if the cluster gets recreated for example).</p>

<h3 id="step4---generate-a-locally-trusted-tls-certificate-for-che">STEP4 - Generate a locally-trusted TLS certificate for Che</h3>

<p>With the CA created at STEP 2 we can issue locally-trusted TLS certificates for any domain. And, compared to <code class="language-plaintext highlighter-rouge">openssl</code>, <code class="language-plaintext highlighter-rouge">mkcert</code> makes the operation easy.</p>

<p>To generates a certificate for <code class="language-plaintext highlighter-rouge">${CHE_DOMAIN_NAME}</code> retrieved at the previous step:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mkcert <span class="s2">"*.</span><span class="k">${</span><span class="nv">CHE_DOMAIN_NAME</span><span class="k">}</span><span class="s2">"</span>
Created a new certificate valid <span class="k">for </span>the following names 📜  
 — “<span class="k">*</span>.192.168.64.34.nip.io”

Reminder: X.509 wildcards only go one level deep, so this won’t match a.b.192.168.64.34.nip.io ℹ️

The certificate is at “./_wildcard.192.168.64.34.nip.io.pem” and the key at “./_wildcard.192.168.64.34.nip.io-key.pem” ✅

It will expire on 29 March 2023 🗓
</code></pre></div></div>

<p>We have just generated a wildcard TLS certificate and private key for Che that is valid until 2023.</p>

<h3 id="step5---configure-che-to-use-the-new-certificate">STEP5 - Configure Che to use the new certificate</h3>

<p>To configure Che to use the certificate generated above we should create a <a href="https://kubernetes.io/docs/concepts/configuration/secret/#tls-secrets">Kubernetes tls secret</a>. We will name it <strong><code class="language-plaintext highlighter-rouge">che-custom-tls</code></strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ CHE_TLS_CERT_PATH</span><span class="o">=</span>./_wildcard.192.168.64.34.nip.io.pem    <span class="c"># Replace the value with the cert path from previous step</span>
  <span class="nv">CHE_TLS_KEY_PATH</span><span class="o">=</span>./_wildcard.192.168.64.34.nip.io-key.pem <span class="c"># Replace the value with the key path from previous step</span>
  <span class="nv">CHE_SERVER_NAMESPACE</span><span class="o">=</span>workspaces-server                    <span class="c"># Replace the value with Che server namespace</span>
  <span class="nv">CHE_TLS_SECRET</span><span class="o">=</span>che-custom-tls
<span class="nv">$ </span>kubectl create secret tls <span class="k">${</span><span class="nv">CHE_TLS_SECRET</span><span class="k">}</span> <span class="se">\</span>
               <span class="nt">--namespace</span> <span class="k">${</span><span class="nv">CHE_SERVER_NAMESPACE</span><span class="k">}</span> <span class="se">\</span>
               <span class="nt">--key</span> <span class="k">${</span><span class="nv">CHE_TLS_KEY_PATH</span><span class="k">}</span> <span class="se">\</span>
               <span class="nt">--cert</span> <span class="k">${</span><span class="nv">CHE_TLS_CERT_PATH</span><span class="k">}</span>
secret/che-custom-tls created
</code></pre></div></div>

<p>We can now update Che configuration to use this secret:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ CHE_CLUSTER</span><span class="o">=</span>eclipse-che   <span class="c"># Replace the value with CheCluster CR name</span>
<span class="nv">$ </span>kubectl patch checluster <span class="s2">"</span><span class="k">${</span><span class="nv">CHE_CLUSTER</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--type</span><span class="o">=</span><span class="s1">'json'</span> <span class="se">\</span>
    <span class="nt">--namespace</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CHE_SERVER_NAMESPACE</span><span class="k">}</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">-p</span><span class="o">=</span><span class="s2">"[{</span><span class="se">\"</span><span class="s2">op</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">replace</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">path</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">/spec/k8s/tlsSecretName</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">value</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="k">${</span><span class="nv">CHE_TLS_SECRET</span><span class="k">}</span><span class="se">\"</span><span class="s2">}]"</span>
checluster.org.eclipse.che/eclipse-che patched
</code></pre></div></div>

<p>A last command is required to include the local CA certificate, created at step 2, in the CA bundle of Che workspaces trusted certificates. This is required to allow communications between workspaces and the Che server.</p>

<p>The convention used to add a certificate in Che CA bundle is via a <code class="language-plaintext highlighter-rouge">ConfigMap</code> in Che server namepsace with labels <code class="language-plaintext highlighter-rouge">app.kubernetes.io/part-of=che.eclipse.org</code> and <code class="language-plaintext highlighter-rouge">app.kubernetes.io/component=ca-bundle</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ LOCAL_CA_CERT</span><span class="o">=</span>~/Library/Application<span class="se">\ </span>Support/mkcert/rootCA.pem  
<span class="nv">$ </span>kubectl create configmap custom-certs <span class="se">\</span>
              <span class="nt">--namespace</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">CHE_SERVER_NAMESPACE</span><span class="k">}</span><span class="s2">"</span> <span class="se">\</span>
              <span class="nt">--from-file</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">LOCAL_CA_CERT</span><span class="k">}</span><span class="s2">"</span>
configmap/custom-certs created
<span class="nv">$ </span>kubectl label configmap custom-certs <span class="se">\</span>
           app.kubernetes.io/part-of<span class="o">=</span>che.eclipse.org <span class="se">\</span>
           app.kubernetes.io/component<span class="o">=</span>ca-bundle <span class="se">\</span>
           <span class="nt">--namespace</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">CHE_SERVER_NAMESPACE</span><span class="k">}</span><span class="s2">"</span>
configmap/custom-certs labeled
</code></pre></div></div>

<h2 id="verification">Verification</h2>

<p><img src="https://che.eclipseprojects.io//assets/img/mkcert/trusted-cert.png" alt="Trusted Certificate" /></p>

<p>If you have followed the steps described above, when opening the Che dashboard in your local browser, you should see that the certificate is considered valid. Starting a workspace should also work without any issue.</p>

<hr />
<hr />

<h3 id="footnotes">Footnotes</h3>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>Adding the URL among the browser exceptions is not enough. Even in single-host mode (when Che uses one unique domain for every endpoint) a fully trusted TLS certificate is required to use <a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">the service worker API</a> <a href="https://github.com/eclipse/che/issues/18566">required by the IDE</a> running in the browser. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>]]></content><author><name>Mario Loriedo</name></author><summary type="html"><![CDATA[Generate a locally-trusted certificate using mkcert and configure Che to use it.]]></summary></entry><entry><title type="html">How to quickly deploy a VS Code extension on Eclipse Che</title><link href="https://che.eclipseprojects.io/2020/07/24/@florent.benoit-how-to-quickly-deploy-a-vs-code-extension-on-eclipse-che.html" rel="alternate" type="text/html" title="How to quickly deploy a VS Code extension on Eclipse Che" /><published>2020-07-24T00:00:00+00:00</published><updated>2020-07-24T00:00:00+00:00</updated><id>https://che.eclipseprojects.io/2020/07/24/@florent.benoit/how-to-quickly-deploy-a-vs-code-extension-on-eclipse-che</id><content type="html" xml:base="https://che.eclipseprojects.io/2020/07/24/@florent.benoit-how-to-quickly-deploy-a-vs-code-extension-on-eclipse-che.html"><![CDATA[<h4 id="introduction">Introduction</h4>

<p>Eclipse Che is supporting VS Code extensions in its IDE.</p>

<p>Each workspace can have its own set of plug-ins. This definition of plug-ins is stored inside a <code class="language-plaintext highlighter-rouge">devfile.yaml</code>file containing as well the list of projects to clone.</p>

<p>From the dashboard, there is a list of plug-ins that can be enabled on a given workspace.</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*AljynvaP6VGvLx1hr4UdwA.png" alt="" /></p>

<p>When a plug-in is enabled, a new entry is added in the <code class="language-plaintext highlighter-rouge">devfile.yaml</code> file.</p>

<p>For example, enabling AsciiDoc plug-in is adding the following snippet in my devfile.</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*JDXduFwsoaxMokw49VxXpA.png" alt="" /></p>

<p>It’s easy but what if the plug-in that I want to try is not in the default Eclipse Che plug-in registry ?</p>

<p>Here come multiple ideas. One of them is to fork the current plug-in-registry repository, rebuild the docker image, deploy it and use this registry. It’s very powerful for ‘in-house’ use-cases, etc but it might be a big effort at first.</p>

<h4 id="setup-configuration">Setup configuration</h4>

<p>Let’s try to make it very simple by just using Github and its <a href="https://gist.github.com/">gist</a> service.</p>

<p>Go on <a href="https://gist.github.com/">https://gist.github.com/</a> and create a README.md file saying for example that : <code class="language-plaintext highlighter-rouge">Try Bracket Pair Colorizer extension in Eclipse Che</code></p>

<p>It’s because I want to try <a href="https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer">https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer</a> with its 3M of downloads !</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*K9B6-Ivap24YRGPvlEXYkg.png" alt="" />
<img src="https://cdn-images-1.medium.com/max/800/1*o9fowXf0ylqqqSZacNRa0w.png" alt="" /></p>

<p>And click on <code class="language-plaintext highlighter-rouge">Create secret gist</code> button</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*p2f_G6UbZ_MXvjY2NtbWdQ.png" alt="" /></p>

<p>You might not know, but behind a gist, there is a git repository. Let’s clone this repository by using the URL from the navbar.</p>

<p>Git clone command will look like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://gist.github.com/&lt;github-username&gt;/&lt;very-long-id&gt;
</code></pre></div></div>

<p>In my case it was</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://gist.github.com/benoitf/85c60c8c439177ac50141d527729b9d9                                                                                                                                                
Cloning into <span class="s1">'85c60c8c439177ac50141d527729b9d9'</span>...  
remote: Enumerating objects: 3, <span class="k">done</span><span class="nb">.</span>  
remote: Counting objects: 100% <span class="o">(</span>3/3<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>  
remote: Total 3 <span class="o">(</span>delta 0<span class="o">)</span>, reused 0 <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused 0  
Unpacking objects: 100% <span class="o">(</span>3/3<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
</code></pre></div></div>

<p>then we enter into this cloned directory</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>85c60c8c439177ac50141d527729b9d9
</code></pre></div></div>

<h4 id="create-the-devfile-and-plug-ins-definition">Create the devfile and plug-ins definition</h4>

<p>First, download the plug-in from the VS Code marketplace <a href="https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer">https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer</a> or from its github page <a href="https://github.com/CoenraadS/BracketPair/releases">https://github.com/CoenraadS/BracketPair/releases</a> and store the file in the cloned directory</p>

<p>Then, we need to add a definition of this plug-in through a yaml file.</p>

<p>Let’s create this file in the cloned directory
<script src="https://gist.github.com/benoitf/04e840a453e46f243c07c2254d68ea0a.js"></script></p>

<p>Two remarks there:</p>

<ul>
  <li>This extension seems to only require nodejs runtime so in the yaml definition I didn’t specified a custom runtime image.</li>
  <li>I’m using  in URL to later compute this link to avoid to search the public URL of the file for now.</li>
</ul>

<p>note: in the <code class="language-plaintext highlighter-rouge">spec</code> section, we can specify a custom runtime image, memory limit and some extra volumes, but for the use-case of this simple extension, it was not required.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spec</span><span class="pi">:</span>  
  <span class="na">containers</span><span class="pi">:</span>  
    <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">quay.io/eclipse/che-sidecar-java:8-0cfbacb"</span>  
      <span class="na">name</span><span class="pi">:</span> <span class="s">vscode-java</span>  
      <span class="na">memoryLimit</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1500Mi"</span>  
      <span class="na">volumes</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/home/theia/.m2"</span>  
        <span class="na">name</span><span class="pi">:</span> <span class="s">m2</span>
</code></pre></div></div>

<p>So, <code class="language-plaintext highlighter-rouge">plugin.vsix</code>file is there, <code class="language-plaintext highlighter-rouge">plugin.yaml</code> file is there and we only need our workspace definition: <code class="language-plaintext highlighter-rouge">devfile.yaml</code></p>

<script src="https://gist.github.com/benoitf/2bce0908836d8dce9171016eafb334f9.js"></script>

<p>You could have taken any other devfile definition., the only important information from this devfile are the lines</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">components</span><span class="pi">:</span>  
  <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">chePlugin</span>  
    <span class="na">reference</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/plugin.yaml"</span>
</code></pre></div></div>

<p>It means that we’ll add a custom plug-in using an external reference vs just an id pointing to a definition inside the default plug-in registry.</p>

<p>To sum up, we have 4 files in the current git directory:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>  
.git  
CoenraadS.bracket-pair-colorizer-1.0.61.vsix  
README.md  
devfile.yaml  
plugin.yaml
</code></pre></div></div>

<p>We will need to commit the files to our repository, but before, we will add a pre-commit hook to update <code class="language-plaintext highlighter-rouge">{{ REPOSITORY }}</code> variable to the public external raw gist link.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># download this script  </span>
<span class="nv">$ </span>curl <span class="nt">-s</span> https://gist.githubusercontent.com/benoitf/e1dd101a6ae157e7e498453dbf683137/raw/2c332278c5a8018b6669da661bbdc6fa10dfb872/pre-commit.sh <span class="o">&gt;</span> .git/hooks/pre-commit

<span class="c"># make it executable  </span>
<span class="nv">$ </span><span class="nb">chmod </span>u+x .git/hooks/pre-commit
</code></pre></div></div>

<p>Pre-commit hook is in place, it’s time to commit our files</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git add <span class="se">\*</span>
</code></pre></div></div>

<p><img src="https://cdn-images-1.medium.com/max/800/1*0FbflRWYdDICdYwAfPYRGA.png" alt="" /></p>

<p>…commit the files…</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git commit <span class="nt">-m</span> <span class="s2">"Initial Commit for the test of our extension"</span> <span class="nb">.</span>                                                                                                                      

<span class="o">[</span>master 98dd370] Initial Commit <span class="k">for </span>the <span class="nb">test </span>of our extension  
 3 files changed, 61 insertions<span class="o">(</span>+<span class="o">)</span>  
 create mode 100644 CoenraadS.bracket-pair-colorizer-1.0.61.vsix  
 create mode 100644 devfile.yaml  
 create mode 100644 plugin.yaml
</code></pre></div></div>

<p>… and push the files to the main branch</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git push origin 
</code></pre></div></div>

<p>By going back to the gist website, we can see that all links have been updated with the correct public URL.</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*jUjdaNPgGRmZSeEe44fqYg.png" alt="" /></p>

<p>Now it’s time to experiment our devfile by entering the command to check that online !</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>open <span class="s2">"https://che.openshift.io/f/?url=</span><span class="si">$(</span>git config <span class="nt">--get</span> remote.origin.url<span class="si">)</span><span class="s2">/raw/devfile.yaml"</span>
</code></pre></div></div>

<p>or if you only want the link</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"https://che.openshift.io/f/?url=</span><span class="si">$(</span>git config <span class="nt">--get</span> remote.origin.url<span class="si">)</span><span class="s2">/raw/devfile.yaml"</span>
</code></pre></div></div>

<p>I can now code with nice brackets :-)</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*T0IcGezki-m-bHM8DB3V7A.gif" alt="" /></p>]]></content><author><name>Florent Benoit</name></author><summary type="html"><![CDATA[Introduction]]></summary></entry><entry><title type="html">Working offline with Eclipse Che</title><link href="https://che.eclipseprojects.io/2020/04/29/@florent.benoit-working-offline-with-eclipse-che.html" rel="alternate" type="text/html" title="Working offline with Eclipse Che" /><published>2020-04-29T00:00:00+00:00</published><updated>2020-04-29T00:00:00+00:00</updated><id>https://che.eclipseprojects.io/2020/04/29/@florent.benoit/working-offline-with-eclipse-che</id><content type="html" xml:base="https://che.eclipseprojects.io/2020/04/29/@florent.benoit-working-offline-with-eclipse-che.html"><![CDATA[<p>Eclipse Che has many thousands of users. Most of them use the VS Code-inspired browser IDE, but sometimes you know you’re going to be offline for awhile and want to be able to work with a local editor, then sync back your changes when you’re back online.</p>

<p>Obviously if you only care about changes to the source code then git will handle this just fine. But if you want to run it offline, make changes to your tools, runtimes or dependencies then it’s great to be able to have all that synced back to Eclipse Che.</p>

<p>In this article we’ll cover how to set this up, by:</p>

<ol>
  <li>Updating your Eclipse Che workspace to allow rsync.</li>
  <li>Importing files into your local computer/laptop.</li>
  <li>Edit/work with your project on your laptop</li>
  <li>Synchronize back all code changes from your laptop to the remote workspace.</li>
</ol>

<h3 id="prerequisites">Prerequisites</h3>

<h3 id="1-on-my-laptop-check-all-tools-are-available">1. On my laptop: check all tools are available</h3>

<ul>
  <li>Check local installation of <code class="language-plaintext highlighter-rouge">rsync</code> on the laptop by trying to execute the command <code class="language-plaintext highlighter-rouge">$ rsync</code>.</li>
  <li>Check installation of <code class="language-plaintext highlighter-rouge">kubectl</code> to execute remote <code class="language-plaintext highlighter-rouge">rsync</code> command.</li>
  <li>Check installation of the<code class="language-plaintext highlighter-rouge">oc</code> CLI if Eclipse Che is running on OpenShift.</li>
</ul>

<p>These tools will need to be on your local machine if they’re not already.</p>

<h3 id="2-in-eclipse-che-workspace">2. In Eclipse Che Workspace</h3>

<p>The <code class="language-plaintext highlighter-rouge">rsync</code> tool needs to be part of the workspace.</p>

<p>Note: with OpenShift we could use <code class="language-plaintext highlighter-rouge">oc rsync</code> command. But there is no exclude filter taken into account, for example. So in this blog post I will use only <code class="language-plaintext highlighter-rouge">kubectl</code> and <code class="language-plaintext highlighter-rouge">rsync</code>.</p>

<p>Your Eclipse Che workspaces may include several running containers. (Workspace pod). Let’s add a new container that will manage only <code class="language-plaintext highlighter-rouge">rsync</code> operations.</p>

<p>I will use the <code class="language-plaintext highlighter-rouge">rsync</code> tool included in the image <code class="language-plaintext highlighter-rouge">quay.io/fbenoit/rsync-simple</code> so no need to build it.</p>

<p>The image includes the following:</p>

<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> alpine:latest  </span>
...  
<span class="k">RUN </span>apk add <span class="nt">--no-cache</span> rsync  
...
</code></pre></div></div>

<p>As you can see this just adds the <code class="language-plaintext highlighter-rouge">rsync</code> tool inside the smallest container possible (based on <code class="language-plaintext highlighter-rouge">alpine</code> linux).</p>

<p>I’ve also added an entry-point to keep the container always-on, and an extra permissions to make it compliant with the random user-id generated by OpenShift.</p>

<h3 id="workflow">Workflow</h3>

<h3 id="1-updating-your-eclipse-che-workspace-to-allowrsync">1. Updating your Eclipse Che workspace to allow rsync</h3>

<p>The <code class="language-plaintext highlighter-rouge">devfile</code> is responsible of the definition of the Eclipse Che workspace.</p>

<p>Edit the <code class="language-plaintext highlighter-rouge">devfile</code> of the workspace from the Eclipse Che dashboard:</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*S4LpqN66DslDBspmSlejwQ.gif" alt="" /></p>

<p>As seen in prerequisites, <code class="language-plaintext highlighter-rouge">rsync</code> tool needs to be part of the workspace and by default it’s not there. Let’s add a new <code class="language-plaintext highlighter-rouge">rsync</code> component and let it have access to <code class="language-plaintext highlighter-rouge">/projects</code> folder using <code class="language-plaintext highlighter-rouge">mountSources: true</code></p>

<p>Add this component into <code class="language-plaintext highlighter-rouge">components</code> section (or create a new <code class="language-plaintext highlighter-rouge">components</code> section first if it’s not there).</p>

<script src="https://gist.github.com/benoitf/e27a11502d0b7215beb77b922fae8c52.js"></script>

<p>Now restart the workspace to finish the inclusion of this new <code class="language-plaintext highlighter-rouge">rsync</code> component. You can check if you’ve been successful by opening the workspace in an IDE and opening the Workspace panel (the cube icon on the right of the IDE):</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*GTpgDTQKdz5EIaKhFb4qAA.gif" alt="" /></p>

<h3 id="3-importing-files-into-your-local-computerlaptop">3. Importing files into your local computer/laptop</h3>

<p>To share files on our laptop and use <code class="language-plaintext highlighter-rouge">rsync</code>, we will need some information.</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">kubectl</code> ready-to-use (authentication performed)</li>
  <li>The name of the running remote workspace pod</li>
  <li>An <code class="language-plaintext highlighter-rouge">rsync</code> bash script</li>
</ol>

<h3 id="31-kubectl">3.1. kubectl</h3>

<p>In my example, I am using the online Eclipse Che instance hosted on <code class="language-plaintext highlighter-rouge">che.openshift.io.</code> I will copy the command to be able to log into OpenShift instance.</p>

<p>I can use the OpenShift web console to do that. To get the web console link, open a terminal inside the IDE by using the Workspace panel within the IDE.</p>

<p><img src="https://cdn-images-1.medium.com/max/800/0*MhsYrMqF5OTUPDqI.gif" alt="" /></p>

<p>Open a terminal inside the Theia IDE container for example. Then type:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="k">${</span><span class="nv">CHE</span><span class="p">\_OSO\_CLUSTER//api/console</span><span class="k">}</span>
</code></pre></div></div>

<p>It will display the URL of the console:</p>

<p><img src="https://cdn-images-1.medium.com/max/800/0*i0COfDvwSTNLulHk.png" alt="" /></p>

<p>Use command+click on <a href="https://console.starter-us-east-2.openshift.com/">https://console.starter-us-east-2.openshift.com/</a><br />
It will open link in default browser. Note that your workspace might be assigned to a different cluster, so the URL might be different as well.</p>

<p>When logged in in the OpenShift console:</p>

<ul>
  <li>Open the top right corner link</li>
  <li>Click on <code class="language-plaintext highlighter-rouge">copy Login command</code> and execute that command on your laptop.</li>
</ul>

<p><img src="https://cdn-images-1.medium.com/max/800/0*cW62ijAisPJtRFrD.png" alt="" /></p>

<p>copy the <code class="language-plaintext highlighter-rouge">oc</code> login command and execute it on your laptop:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>oc login https://api.starter-us-east-2.openshift.com — <span class="nv">token</span><span class="o">=</span>tHeEnCoDeDtOkEn  
Logged into <span class="s2">"https://api.starter-us-east-2.openshift.com:443"</span> using the token provided.
</code></pre></div></div>

<p>Then use your namespace (ending with -che) using <code class="language-plaintext highlighter-rouge">oc project &lt;namespace&gt;</code> command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>oc project &lt;namespace&gt;-che
</code></pre></div></div>

<p>And we can check that the workspace pod is there by using <code class="language-plaintext highlighter-rouge">oc get pods</code> or <code class="language-plaintext highlighter-rouge">kubectl get pods</code> commands.</p>

<p><img src="https://cdn-images-1.medium.com/max/800/0*H1wbQjKPG9855lJK.png" alt="" /></p>

<h3 id="32-name-of-the-workspace-pod">3.2. Name of the workspace pod</h3>

<p>We will copy files from the remote workspace to our local machine.</p>

<p>We need the name of the workspace. It is available from a terminal with the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$HOSTNAME</span>
</code></pre></div></div>

<p><img src="https://cdn-images-1.medium.com/max/800/0*FNc5U92npf5UhCs8.png" alt="" /></p>

<p>Another way is to use the <code class="language-plaintext highlighter-rouge">kubectl</code> or <code class="language-plaintext highlighter-rouge">oc</code> tool to find the workspace pod name (<code class="language-plaintext highlighter-rouge">$ kubectl get pods</code> or <code class="language-plaintext highlighter-rouge">$ oc get pods</code>).</p>

<p>The name of the container that includes <code class="language-plaintext highlighter-rouge">rsync</code> is “rsync” as it’s the alias name we defined in the <code class="language-plaintext highlighter-rouge">devfile</code>.</p>

<h3 id="33-the-rsyncscript">3.3. The rsync script</h3>

<p>To import the project files into Eclipse Che workspace, we will now use <code class="language-plaintext highlighter-rouge">rsync.</code></p>

<p>We will need a shell script to perform the copy and this script will use <code class="language-plaintext highlighter-rouge">kubectl exec</code> command.</p>

<p>Create a new file <code class="language-plaintext highlighter-rouge">kubectl-rsync.sh</code> with the following content:</p>

<script src="https://gist.github.com/benoitf/0189f4399beb9fc72392e5cbd9655add.js"></script>

<p>Don’t forget to make it executable: <code class="language-plaintext highlighter-rouge">chmod u+x kubectl-rsync.sh</code> and now let’s assume you copy it to <code class="language-plaintext highlighter-rouge">${HOME}/bin</code> folder.</p>

<p>Now, let’s create another script named <code class="language-plaintext highlighter-rouge">workspace-sync.sh</code></p>

<script src="https://gist.github.com/benoitf/abb5b1d13105eab0d8a357ee75cbaacc.js"></script>

<p>Apply permissions by using <code class="language-plaintext highlighter-rouge">chmod u+x workspace-sync.sh</code>.</p>

<p>Copy it, for example, to <code class="language-plaintext highlighter-rouge">${HOME}/bin</code> folder. We’re using the <code class="language-plaintext highlighter-rouge">-e</code> option in rsync parameters to specify another shell.</p>

<p>Now that our scripts have been setup, it’s time to use them.</p>

<p>First, we store the workspace pod into an env variable:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">export </span><span class="nv">WORKSPACE_POD</span><span class="o">=</span>workspacelmog4zkmikhxpc87.workspace-74d787cf95-xbd26
</code></pre></div></div>

<p>Let’s proceed to the first import.</p>

<p>Assuming our remote workspace has files in <code class="language-plaintext highlighter-rouge">/projects/</code> and that we want to copy workspace files it to <code class="language-plaintext highlighter-rouge">${HOME}/my-workspace</code> on our laptop, execute the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ RSYNC_OPTIONS</span><span class="o">=</span><span class="s2">"--progress --stats"</span> RSYNC<span class="se">\_</span><span class="nv">FROM</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">WORKSPACE_POD</span><span class="k">}</span><span class="s2">:/projects/"</span> <span class="nv">RSYNC_TO</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span><span class="s2">/my-workspace"</span> <span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/bin/workspace-sync.sh
</code></pre></div></div>

<p>Now files are being transferred into our laptop.</p>

<p>We see progress due to <code class="language-plaintext highlighter-rouge">--progress</code> option. You may add<code class="language-plaintext highlighter-rouge">--exclude ‘node_modules'</code> in <code class="language-plaintext highlighter-rouge">RSYNC_OPTIONS</code> for nodejs projects to exclude unwanted files.</p>

<p>In your laptop you should see <code class="language-plaintext highlighter-rouge">my-project</code> folder in <code class="language-plaintext highlighter-rouge">${HOME}</code> directory.</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*ts2FYhqX1f_MI4umWvhPiw.png" alt="" /></p>

<h3 id="4-editwork-with-your-project-on-yourlaptop">4. Edit/work with your project on your laptop</h3>

<p>Well here, you can do whatever you like with your project that has been synchronized to <code class="language-plaintext highlighter-rouge">${HOME}/my-workspace/my-project</code></p>

<p>For example if it’s a java/maven project you can run <code class="language-plaintext highlighter-rouge">mvn</code> command there or run <code class="language-plaintext highlighter-rouge">yarn</code> for nodejs project, etc.</p>

<h3 id="5-synchronize-back-all-thechanges">5. Synchronize back all the changes</h3>

<p>All modified files are now on your local computer so you can edit them. But at some point you’ll want those changes back in the remote Che workspace.</p>

<p>We’ll use the same <code class="language-plaintext highlighter-rouge">workspace-sync.sh</code> script but we’ll reverse the source and destination. Because now we want to copy laptop’s changes to the remote workspace and not the previous way. Also, we’ll set this time <code class="language-plaintext highlighter-rouge">RSYNC_INFINITE=true</code> to do rsync every 15s (to never miss local changes).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ RSYNC_FROM</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span><span class="s2">/</span><span class="sb">`</span>my-workspace<span class="sb">`</span><span class="s2">/"</span> <span class="nv">RSYNC_TO</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">WORKSPACE_POD</span><span class="k">}</span><span class="s2">:/projects/"</span> <span class="nv">RSYNC_INFINITE</span><span class="o">=</span><span class="s2">"true"</span> <span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/bin/workspace-sync.sh
</code></pre></div></div>

<p>You can drop <code class="language-plaintext highlighter-rouge">--progress --stats</code> from <code class="language-plaintext highlighter-rouge">RSYNC_OPTIONS</code> so you don’t generate too much output now that you’ve confirmed it works.</p>

<p>One issue is that when syncing back the changes, we don’t want to upload the whole node_modules folder. Adding the <code class="language-plaintext highlighter-rouge">--exclude node_modules</code> parameter takes care of that.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">RSYNC_OPTIONS</span><span class="o">=</span><span class="s2">"--exclude node</span><span class="se">\_</span><span class="s2">modules"</span>
</code></pre></div></div>

<p>The script now checks all the changes every 15 seconds.</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*pvDlDYPzSFvS1GJoiWpkiA.png" alt="" /></p>

<p>All changes from my filesystem are now inside my remote workspace.</p>

<p>Let’s check:</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*HaCqORV_sD3gozrIE847oQ.png" alt="" /></p>

<h3 id="6-finishing">6. Finishing</h3>

<p>When we’re done working we can double-check that the rsync script has finished to copy all files remotely and then delete the project on our laptop.</p>

<p>One you have this all set up it’s easy to either leave it running all the time and fluidly move from editing on your laptop and editing in the cloud. Or only turn it on when you know you’ll be offline for awhile (like for a trip).</p>]]></content><author><name>Florent Benoit</name></author><summary type="html"><![CDATA[Learn how to work offline with Che and sync back changes when you’re back online.]]></summary></entry><entry><title type="html">Import a project from your laptop to an Eclipse Che workspace.</title><link href="https://che.eclipseprojects.io/2020/04/02/@florent.benoit-work-on-my-laptops-project-from-a-remote-eclipse-che-workspace.html" rel="alternate" type="text/html" title="Import a project from your laptop to an Eclipse Che workspace." /><published>2020-04-02T00:00:00+00:00</published><updated>2020-04-02T00:00:00+00:00</updated><id>https://che.eclipseprojects.io/2020/04/02/@florent.benoit/work-on-my-laptops-project-from-a-remote-eclipse-che-workspace</id><content type="html" xml:base="https://che.eclipseprojects.io/2020/04/02/@florent.benoit-work-on-my-laptops-project-from-a-remote-eclipse-che-workspace.html"><![CDATA[<p>Eclipse Che is a Kubernetes-Native IDE. It might be interesting to work on your project using remote resources instead of consuming your laptop resources. Another interesting way is to use containers that might be used in production as well.</p>

<p>Also let say you’re running out of battery, you may spare CPU and get extra time !</p>

<p>In this article we’ll cover how to set this up, by:</p>

<ol>
  <li>Defining an Eclipse Che workspace for a project (create a <code class="language-plaintext highlighter-rouge">devfile</code>).</li>
  <li>Starting an Eclipse Che workspace ready to receive the project.</li>
  <li>Pushing / importing the local files into the remote Eclipse Che workspace.</li>
  <li>Coding using Eclipse Che.</li>
  <li>Synchronizing all code changes with <code class="language-plaintext highlighter-rouge">rsync</code>.</li>
  <li>Stopping the Che workspace and even deleting it without impacting the local copy.</li>
</ol>

<h3 id="prerequisites">Prerequisites</h3>

<h4 id="1-on-my-laptop-check-all-tools-are-available">1. On my laptop: check all tools are available</h4>

<ul>
  <li>Check local installation of <code class="language-plaintext highlighter-rouge">rsync</code> on the laptop by trying to execute the command <code class="language-plaintext highlighter-rouge">$ rsync</code></li>
  <li>Check installation of <code class="language-plaintext highlighter-rouge">kubectl</code> to execute <code class="language-plaintext highlighter-rouge">rsync</code> command.</li>
  <li>Check installation of <code class="language-plaintext highlighter-rouge">oc</code> if Eclipse Che is running on top of OpenShift.</li>
</ul>

<p>If these tools are not installed, please install them.</p>

<h4 id="2-in-eclipse-che-workspace">2. In Eclipse Che Workspace</h4>

<p><code class="language-plaintext highlighter-rouge">rsync</code>tool needs to be part of the workspace.</p>

<p>Note: with OpenShift we could use<code class="language-plaintext highlighter-rouge">oc rsync</code> command. But there is no exclude filter taken into account for example. So in this blog post I will use only <code class="language-plaintext highlighter-rouge">kubectl</code>and <code class="language-plaintext highlighter-rouge">rsync</code>tools</p>

<p>Eclipse Che workspaces may include several running containers. (Workspace pod). Let’s add a new container that will manage only <code class="language-plaintext highlighter-rouge">rsync</code> operations.</p>

<p>For the demo, I will create a custom OCI image based on alpine. In this custom image, I will install <code class="language-plaintext highlighter-rouge">rsync tool.</code></p>

<p>I’ve published this image under <code class="language-plaintext highlighter-rouge">quay.io/fbenoit/rsync-simple</code> so no need to build it.</p>

<p>The image includes the following:</p>

<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> alpine:latest  </span>
...  
<span class="k">RUN </span>apk add <span class="nt">--no-cache</span> rsync  
...
</code></pre></div></div>

<p>As you can see this just adds the<code class="language-plaintext highlighter-rouge">rsync</code> tool inside the smallest container possible (based on <code class="language-plaintext highlighter-rouge">alpine</code> linux).</p>

<p>I’ve also added an entry-point to keep the container always-on. I added extra permissions to make it compliant with random user-id for OpenShift.</p>

<h4 id="3-a-localproject">3. A local project</h4>

<p>To make sure that everyone can reproduce the test, it’s important to use the same local project :-)</p>

<p>The project I’m using is a clone of <a href="https://github.com/che-samples/react-web-app">https://github.com/che-samples/react-web-app</a></p>

<p>I’ve cloned it into <code class="language-plaintext highlighter-rouge">$HOME/react-web-app</code> folder.</p>

<p>The application is a Nodejs example.</p>

<h3 id="workflow">Workflow</h3>

<h4 id="1-define-an-eclipse-che-workspace-for-my-project-create-adevfile">1. Define an Eclipse Che workspace for my project (create a devfile)</h4>

<p>Let’s start with a minimalist devfile. The devfile is responsible of creating the Eclipse Che workspace.</p>

<script src="https://gist.github.com/benoitf/c910348251322bb1155bea7cfed7057f.js"></script>

<p>I set <code class="language-plaintext highlighter-rouge">persistVolumes</code> to false as the storage will be our laptop. I don’t want to use remote storage to save my project files.</p>

<p>As seen in prerequisites, <code class="language-plaintext highlighter-rouge">rsync</code>tool needs to be part of the workspace. Let’s add a new <code class="language-plaintext highlighter-rouge">rsync</code> component and let it have access to <code class="language-plaintext highlighter-rouge">/projects</code> folder using <code class="language-plaintext highlighter-rouge">mountSources: true</code></p>

<script src="https://gist.github.com/benoitf/73748447b14f499e49180ff61baa6678.js"></script>

<p>The workspace now includes the <code class="language-plaintext highlighter-rouge">rsync</code> tool.</p>

<p>Let’s add new components to work on the project with Eclipse Che.</p>

<p>The project that I want to import is a Nodejs project.</p>

<p>Now I add :</p>

<ul>
  <li>Intellisense with a typescript plugin</li>
  <li><code class="language-plaintext highlighter-rouge">nodejs</code> component to have node tools.</li>
</ul>

<script src="https://gist.github.com/benoitf/90499b50bf081ef4eb43a5cb3bb39290.js"></script>

<h4 id="2-start-an-eclipse-che-workspace-ready-to-receive-myproject">2. Start an Eclipse Che workspace ready to receive my project</h4>

<p>The workspace definition is ready with the devfile.</p>

<p>There are a few ways we can start the Che workspace:</p>

<ul>
  <li>Importing this devfile into the Eclipse Che dashboard</li>
  <li>Using <code class="language-plaintext highlighter-rouge">chectl</code> with the devfile</li>
  <li>Opening this <a href="http://che.openshift.io/f/?url=https://gist.githubusercontent.com/benoitf/90499b50bf081ef4eb43a5cb3bb39290/raw/6b5fcb5fa9abf28693dc74ac20cb8d6c01cc4345/devfile.yaml">direct link</a> that creates and starts the workspace</li>
</ul>

<p><img src="https://cdn-images-1.medium.com/max/800/1*LsTwkOIAEZ1N_R4xcOB2zg.png" alt="" /></p>

<p>After the startup of the workspace, we can see the IDE. We can see that there are no files in project tree. This is normal because we want to import our local project folder.</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*aQdSPCSpzoy8GWf2r4LlKQ.png" alt="" /></p>

<h4 id="3-pushimport-into-the-remote-eclipse-che-workspace-the-localfiles">3. Push/Import into the remote Eclipse Che workspace the local files</h4>

<p>To push files to the remote workspace and use rsync, we will need some information.</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">kubectl</code> ready-to-use (authentication performed)</li>
  <li>The name of the workspace pod</li>
  <li>A rsync bash script</li>
</ol>

<h4 id="31-kubectl">3.1. kubectl</h4>

<p>In my example, I am using the online Eclipse Che instance hosted on <code class="language-plaintext highlighter-rouge">che.openshift.io.</code> I will copy the command to be able to log into OpenShift instance.</p>

<p>I can use the OpenShift web console to do that. To get the web console link, open a terminal inside the IDE by using the Workspace panel within the IDE</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*8tRQjynD-Vz105I7QAEMMg.gif" alt="" /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="k">${</span><span class="nv">CHE_OSO_CLUSTER</span><span class="p">//api/console</span><span class="k">}</span>
</code></pre></div></div>

<p>It will display the URL of the console</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*t40cl9LnEzFjKK308q6CdQ.png" alt="" /></p>

<p>Use command+click on <a href="https://console.starter-us-east-2.openshift.com/">https://console.starter-us-east-2.openshift.com/</a><br />
It will open link in default browser.<br />
Note: your cluster might be different so the URL might be different as well.</p>

<p>When logged in in the OpenShift console:</p>

<ul>
  <li>Open the top right corner link</li>
  <li>Click on <code class="language-plaintext highlighter-rouge">copy Login command</code> and execute that command on your laptop.</li>
</ul>

<p><img src="https://cdn-images-1.medium.com/max/800/1*74zeKYsoqUWIr6hIMx3keQ.png" alt="" /></p>

<p>You should be now connected from your laptop to the OpenShift cluster.</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*hejFl6A3OUzstkjPNjZDUg.png" alt="" /></p>

<h4 id="32-name-of-the-workspace-pod">3.2. Name of the workspace pod</h4>

<p>We will copy files from the remote workspace.</p>

<p>We need the name of the workspace. It is available from a terminal with the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$HOSTNAME</span>
</code></pre></div></div>

<p><img src="https://cdn-images-1.medium.com/max/800/1*e94TBeKu3SR2HLmA5AXrRg.png" alt="" /></p>

<p>Another way is to use<code class="language-plaintext highlighter-rouge">kubectl</code> or <code class="language-plaintext highlighter-rouge">oc</code>tool to find the workspace pod name (<code class="language-plaintext highlighter-rouge">$ kubectl get pods</code>or <code class="language-plaintext highlighter-rouge">$ oc get pods</code>).</p>

<p>Name of the container that includes <code class="language-plaintext highlighter-rouge">rsync</code> is rsync as it’s the alias name we defined in the devfile.</p>

<h4 id="33-the-rsyncscript">3.3. The rsync script</h4>

<p>To import the project files into Eclipse Che workspace, we will now use <code class="language-plaintext highlighter-rouge">rsync.</code></p>

<p>We will need a shell script to perform the copy and this script will use <code class="language-plaintext highlighter-rouge">kubectl exec</code> command.</p>

<p>Create a new file <code class="language-plaintext highlighter-rouge">kubectl-rsync.sh</code> with the following content:</p>

<script src="https://gist.github.com/benoitf/0189f4399beb9fc72392e5cbd9655add.js"></script>

<p>And make it executable: <code class="language-plaintext highlighter-rouge">chmod u+x kubectl-rsync.sh</code> and now let’s assume you copy it to <code class="language-plaintext highlighter-rouge">${HOME}/bin</code> folder.</p>

<p>Now, let’s create another script named <code class="language-plaintext highlighter-rouge">workspace-sync.sh</code></p>

<script src="https://gist.github.com/benoitf/abb5b1d13105eab0d8a357ee75cbaacc.js"></script>

<p>Apply permissions by using <code class="language-plaintext highlighter-rouge">chmod u+x workspace-sync.sh</code></p>

<p>Copy it for example to <code class="language-plaintext highlighter-rouge">${HOME}/bin</code> folder. We’re using the <code class="language-plaintext highlighter-rouge">-e</code> option in rsync parameters to specify another shell.</p>

<p>Now that our scripts have been setup, it’s time to use them.</p>

<p>First, we store the workspace pod into an env variable:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">export </span><span class="nv">WORKSPACE_POD</span><span class="o">=</span>workspacelmog4zkmikhxpc87.workspace-74d787cf95-xbd26
</code></pre></div></div>

<p>Let’s proceed to the first import.</p>

<p>Assuming our local Nodejs app is in <code class="language-plaintext highlighter-rouge">${HOME}/react-web-app</code>, execute the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ RSYNC_OPTIONS</span><span class="o">=</span><span class="s2">"--progress --stats --exclude 'node</span><span class="se">\_</span><span class="s2">modules'"</span> <span class="nv">RSYNC_FROM</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span><span class="s2">/react-web-app"</span> <span class="nv">RSYNC_TO</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">WORKSPACE_POD</span><span class="k">}</span><span class="s2">:/projects/"</span> <span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/bin/workspace-sync.sh
</code></pre></div></div>

<p>Files are being transferred into the remote workspace.</p>

<p>We see progress due to <code class="language-plaintext highlighter-rouge">--progress</code> option.</p>

<p>In the UI now we see <code class="language-plaintext highlighter-rouge">react-web-app</code> folder:</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*0ILdTv5LWAp_oHzVmIrO1A.png" alt="" /></p>

<h4 id="4-code-using-eclipseche">4. Code using Eclipse Che</h4>

<p>Let’s use yarn command to launch the project inside Eclipse Che.</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*stAPWxgcnhcvPkSgqTto4g.gif" alt="" /></p>

<p>And now start the webapp using <code class="language-plaintext highlighter-rouge">yarn start</code> command inside <code class="language-plaintext highlighter-rouge">/projects/react-web-app</code></p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*1MlP-Ejs6JS8fBniZZUMHw.gif" alt="" /></p>

<p>And edit <code class="language-plaintext highlighter-rouge">src/App.tsx</code> file and see the result.</p>

<h4 id="5-synchronize-back-all-thechanges">5. Synchronize back all the changes</h4>

<p>All modified files are in my Eclipse Che workspace. But I want to keep my local folder on my laptop in sync with my new remote changes.</p>

<p>We’ll use the same <code class="language-plaintext highlighter-rouge">workspace-sync.sh</code> script but we’ll reverse the source and destination. Because now we want to copy remote changes to the laptop and not the previous way. Also, we’ll set this time <code class="language-plaintext highlighter-rouge">RSYNC_INFINITE=true</code> to do rsync every 15s (to never miss remote changes).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ RSYNC_OPTIONS</span><span class="o">=</span><span class="s2">"--exclude node_modules"</span> <span class="nv">RSYNC_FROM</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">WORKSPACE_POD</span><span class="k">}</span><span class="s2">:/projects/react-web-app/"</span> <span class="nv">RSYNC_TO</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span><span class="s2">/react-web-app/"</span> <span class="nv">RSYNC_INFINITE</span><span class="o">=</span><span class="s2">"true"</span> <span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/bin/workspace-sync.sh
</code></pre></div></div>

<p>I dropped <code class="language-plaintext highlighter-rouge">--progress --stats</code> from <code class="language-plaintext highlighter-rouge">RSYNC_OPTIONS</code> to not generate too much output.</p>

<p>One issue is that when syncing back the changes, we don’t want to download the whole node_modules folder. Adding the <code class="language-plaintext highlighter-rouge">--exclude node_modules</code> parameter takes care of that.</p>

<p>The script now checks all the changes every 15 seconds.</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*f8fhfbCvpuX2FX7RRDF-9A.png" alt="" /></p>

<p>All changes from Eclipse Che workspace are now inside my filesystem.</p>

<p>Let’s check:</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*ukJ137UX5FqrEehw3jd-7g.png" alt="" /></p>

<h4 id="6-finishing">6. Finishing</h4>

<p>When we’re done working we can double-check that the rsync script has finished to copy all files to my laptop, then stop the Eclipse Che workspace. We can even delete the stopped Che workspace as we have all the up-to-date changes saved on our local drive.</p>

<p>Note: With <code class="language-plaintext highlighter-rouge">persistVolumes=false</code> , restarting the workspace will result in an empty project tree again until you re-run the laptop-to-remote-Che sync script.</p>]]></content><author><name>Florent Benoit</name></author><summary type="html"><![CDATA[Here is the use-case: I have a project on my laptop that I am working on by using a local IDE. And now, I want to work on that project…]]></summary></entry></feed>